// ==================================
// Testimonials Enhanced Section - BEM Component
// ==================================
//
// Purpose: Client testimonials with ratings, avatar placeholders, and enhanced styling
// Features: White cards, left borders, floating quotes, avatar initials, staggered animations
// Breakpoints: Stack mobile, multi-column desktop
//
// Version: 3.0.0 - Design Enhancement Update
// Updated: 2025-11-23
//

// ============================================================================
// BLOCK: Testimonials Section
// ============================================================================

/**
 * DESIGN EXCELLENCE: Overlapping Elements
 * Principle: "Elements touch/bleed into each other = rhythm, organic flow, vibrant pulse"
 * Testimonials section uses negative margin to overlap into adjacent sections
 */
.c-testimonials {
  position: relative;
  padding: var(--testimonials-padding);
  background-color: var(--testimonials-bg);
  overflow: visible; // DESIGN EXCELLENCE: Allow cards to overflow into adjacent sections

  // Background variants
  &--bg-light { background-color: var(--testimonials-bg); }
  &--bg-white { background-color: var(--color-white); }

  // DESIGN EXCELLENCE: Section overlap modifier
  // Cards extend beyond section boundary for visual flow
  &--overlap {
    margin-bottom: -60px; // Pull next section up
    padding-bottom: calc(var(--testimonials-padding) + 60px); // Compensate

    @media (min-width: $breakpoint-lg) {
      margin-bottom: -80px; // More overlap on desktop
      padding-bottom: calc(var(--testimonials-padding) + 80px);
    }
  }
}

// ============================================================================
// ELEMENT: Decorative Quote Mark (large background element)
// ============================================================================

.c-testimonials__decorative-quote {
  position: absolute;
  top: 60px;
  left: 40px;
  font-size: var(--testimonials-decorative-quote-size);
  color: var(--testimonials-decorative-quote-color);
  opacity: var(--testimonials-decorative-quote-opacity);
  pointer-events: none;
  z-index: 0;
  line-height: 1;

  @media (min-width: 768px) {
    top: 80px;
    left: 60px;
    font-size: var(--testimonials-decorative-quote-size-tablet);
  }

  @media (min-width: 992px) {
    top: 100px;
    left: 80px;
    font-size: var(--testimonials-decorative-quote-size-desktop);
  }
}

// ============================================================================
// ELEMENT: Header
// ============================================================================

.c-testimonials__header {
  position: relative;
  z-index: 1; // Above decorative quote
  max-width: var(--testimonials-header-max-width);
  margin: 0 auto var(--testimonials-header-margin-bottom);
  text-align: center;
}

.c-testimonials__subtitle {
  font-family: var(--font-family-sans);
  font-size: var(--testimonials-subtitle-font-size);
  font-weight: var(--font-weight-semibold);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--testimonials-subtitle-color);
  margin-bottom: var(--spacing-xs);
}

.c-testimonials__title {
  font-size: var(--font-size-3xl);
  margin-bottom: var(--spacing-md);

  @media (min-width: 768px) {
    font-size: var(--font-size-4xl); // Increased from 3xl
  }
}

.c-testimonials__description {
  font-family: var(--font-family-sans);
  font-size: var(--font-size-lg);
  line-height: var(--testimonials-description-line-height);
  color: var(--color-text-secondary);
  margin: 0;
}

// ============================================================================
// ELEMENT: Testimonials Grid
// ============================================================================

.c-testimonials__grid {
  position: relative;
  z-index: 1; // Above decorative quote
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: var(--testimonials-grid-gap);
  margin-bottom: var(--testimonials-grid-margin-bottom);
}

// ============================================================================
// ELEMENT: Testimonial Card
// ============================================================================

/**
 * DESIGN EXCELLENCE: Card Overlap Effect
 * Principle: "Overlapping creates layers that make design feel more dynamic"
 * Featured testimonial card breaks the grid, creating visual hierarchy
 */
.c-testimonials__item {
  position: relative; // For floating quote and avatar positioning
  background-color: var(--testimonials-card-bg);
  border: var(--testimonials-card-border);
  border-left: var(--testimonials-card-border-left-width) solid transparent; // Will be set by variant modifiers
  border-radius: var(--testimonials-card-border-radius);
  padding: var(--testimonials-card-padding);
  box-shadow: var(--testimonials-card-shadow);
  transition: var(--testimonials-card-transition);

  // Hover effect
  &:hover {
    transform: var(--testimonials-card-transform-hover);
    box-shadow: var(--testimonials-card-shadow-hover);
    border-left-width: var(--testimonials-card-border-left-width-hover); // Intensify on hover
  }

  // Mobile: reduce padding
  @media (max-width: $breakpoint-md-max) {
    padding: var(--testimonials-card-padding-mobile);
  }

  // Left border color rotation (primary → secondary → coral)
  &--primary { border-left-color: var(--testimonials-card-border-primary); }
  &--secondary { border-left-color: var(--testimonials-card-border-secondary); }
  &--coral { border-left-color: var(--testimonials-card-border-coral); }

  // DESIGN EXCELLENCE: Featured card that breaks the grid
  &--featured {
    @media (min-width: $breakpoint-lg) {
      // Extend beyond grid column
      margin-left: -20px;
      margin-right: -20px;
      padding: calc(var(--testimonials-card-padding) + 8px);

      // Visual emphasis
      box-shadow: var(--testimonials-card-shadow-hover),
                  0 30px 60px -20px rgba($forest-500, 0.15);
      border-left-width: 6px;
      z-index: 2;

      // Slight scale for prominence
      transform: scale(1.02);

      &:hover {
        transform: scale(1.02) translateY(-4px);
      }
    }
  }

  // DESIGN EXCELLENCE: Staggered overlap effect for grid items
  // Alternating cards have slight vertical offset for organic feel
  @media (min-width: $breakpoint-lg) {
    &:nth-child(even) {
      margin-top: 24px; // Offset creates visual rhythm
    }
  }
}

// ============================================================================
// ELEMENT: Floating Quote Mark (top-right corner)
// ============================================================================

.c-testimonials__floating-quote {
  position: absolute;
  top: var(--spacing-md);
  right: var(--spacing-md);
  font-size: var(--testimonials-floating-quote-size);
  color: var(--testimonials-floating-quote-color);
  opacity: var(--testimonials-floating-quote-opacity);
  line-height: 1;
  pointer-events: none;
}

// ============================================================================
// ELEMENT: Avatar Placeholder
// ============================================================================

.c-testimonials__avatar {
  width: var(--testimonials-avatar-size);
  height: var(--testimonials-avatar-size);
  margin: var(--testimonials-avatar-margin);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--border-radius-full);
  box-shadow: var(--testimonials-avatar-shadow);

  // Gradient backgrounds (rotation: primary → secondary → coral)
  &--primary {
    background: var(--testimonials-avatar-primary-gradient);
  }

  &--secondary {
    background: var(--testimonials-avatar-secondary-gradient);
  }

  &--coral {
    background: var(--testimonials-avatar-coral-gradient);
  }
}

.c-testimonials__initials {
  font-family: var(--font-family-sans);
  font-size: var(--testimonials-initials-font-size);
  font-weight: var(--font-weight-semibold);
  color: var(--color-white);
  text-transform: uppercase;
}

// ============================================================================
// ELEMENT: Star Rating
// ============================================================================

.c-testimonials__rating {
  display: flex;
  gap: 4px;
  margin-bottom: var(--spacing-md);
  justify-content: center;
}

.c-testimonials__star {
  font-size: var(--testimonials-star-size);
  transition: transform 0.2s ease-out;

  &--filled {
    color: var(--testimonials-star-color-filled);
    // Subtle glow effect
    filter: var(--testimonials-star-glow);
  }

  &--empty {
    color: var(--testimonials-star-color-empty);
    opacity: 0.3;
  }

  // Hover effect (optional, for interactive stars)
  &--filled:hover {
    transform: var(--testimonials-star-transform-hover);
  }
}

// ============================================================================
// ELEMENT: Quote Text
// ============================================================================

.c-testimonials__quote {
  position: relative; // Phase 2: For decorative quote mark
  font-family: var(--font-family-heading);
  font-size: var(--testimonials-quote-font-size);
  font-style: italic;
  line-height: var(--testimonials-quote-line-height);
  color: var(--color-text-primary);
  margin-bottom: var(--spacing-lg);
  padding-top: var(--testimonials-quote-padding-top);

  // Remove default blockquote styling
  padding-left: 0;
  padding-right: 0;
  border: none;

  // Phase 2: Decorative oversized opening quote mark
  &::before {
    content: '"';
    position: absolute;
    top: -1rem;
    left: -0.5rem;
    font-size: var(--testimonials-quote-decoration-size);
    line-height: 1;
    opacity: var(--testimonials-quote-decoration-opacity);
    color: var(--testimonials-quote-decoration-color);
    font-family: Georgia, serif; // Serif for elegance
    pointer-events: none;
  }

  p {
    margin: 0;
  }
}

// ============================================================================
// ELEMENT: Author Info
// ============================================================================

.c-testimonials__author {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: var(--spacing-sm);
  margin-top: var(--testimonials-author-margin-top);
  padding-top: var(--spacing-md);
  border-top: var(--testimonials-author-border-top);
}

.c-testimonials__author-details {
  flex: 1;
}

.c-testimonials__author-name {
  font-family: var(--font-family-sans);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin-bottom: var(--testimonials-author-name-margin-bottom);
}

.c-testimonials__author-meta {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.c-testimonials__meta-item {
  font-family: var(--font-family-sans);
  font-size: var(--font-size-sm);
  color: var(--color-text-tertiary);
}

.c-testimonials__verified {
  flex-shrink: 0;
  color: var(--testimonials-verified-color);
  font-size: var(--testimonials-verified-size);
}

// ============================================================================
// ELEMENT: Outcome
// ============================================================================

.c-testimonials__outcome {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  padding: var(--testimonials-outcome-padding);
  margin-top: var(--spacing-md);
  background-color: var(--testimonials-outcome-bg);
  border-radius: var(--testimonials-outcome-border-radius);
}

.c-testimonials__outcome-icon {
  flex-shrink: 0;
  font-size: var(--testimonials-outcome-icon-size);
}

.c-testimonials__outcome-text {
  font-family: var(--font-family-sans);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

// ============================================================================
// ELEMENT: Privacy Note (Card format)
// ============================================================================

.c-testimonials__privacy {
  position: relative;
  z-index: 1; // Above decorative quote
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  max-width: var(--testimonials-privacy-max-width);
  margin: 0 auto var(--spacing-3xl);
  padding: var(--testimonials-privacy-padding);
  background-color: var(--testimonials-privacy-bg);
  border: var(--testimonials-privacy-border);
  border-radius: var(--testimonials-privacy-border-radius);
  box-shadow: var(--shadow-xs);
}

.c-testimonials__privacy-icon {
  flex-shrink: 0;
  font-size: var(--testimonials-privacy-icon-size);
  color: var(--testimonials-privacy-icon-color);
}

.c-testimonials__privacy-text {
  font-family: var(--font-family-sans);
  font-size: var(--font-size-sm);
  color: var(--testimonials-privacy-text-color);
  text-align: center;

  p {
    margin: 0;
  }
}

// ============================================================================
// ELEMENT: CTA Button
// ============================================================================

.c-testimonials__cta {
  position: relative;
  z-index: 1; // Above decorative quote
  display: flex;
  justify-content: center;
}

// ============================================================================
// RESPONSIVE ADJUSTMENTS
// ============================================================================

@media (max-width: $breakpoint-lg-max) {
  .c-testimonials {
    padding: var(--testimonials-padding-tablet);
  }

  .c-testimonials__grid {
    gap: var(--testimonials-grid-gap-tablet);
  }
}

@media (max-width: $breakpoint-md-max) {
  .c-testimonials {
    padding: var(--testimonials-padding-mobile);
  }

  .c-testimonials__grid {
    grid-template-columns: 1fr;
    gap: var(--testimonials-grid-gap-mobile);
  }

  .c-testimonials__decorative-quote {
    font-size: 100px; // Decorative element - intentionally large, not tokenized
    top: 40px;
    left: 20px;
  }
}

// ============================================================================
// ACCESSIBILITY
// ============================================================================

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .c-testimonials__item {
    transition: none;

    &:hover {
      transform: none;
    }
  }

  .c-testimonials__star--filled:hover {
    transform: none;
  }
}

// Print styles
@media print {
  .c-testimonials {
    padding: var(--spacing-lg) 0;
  }

  .c-testimonials__cta {
    display: none;
  }

  .c-testimonials__decorative-quote {
    display: none;
  }
}

// ============================================================================
// LEGACY SUPPORT
// ============================================================================

.testimonials-enhanced {
  @extend .c-testimonials;
}
