// ==================================
// NAVIGATION COMPONENT - BEM Architecture
// ==================================
//
// Purpose: Reusable navigation molecule for main site menu (vanilla JS)
// Features: Dropdown support, active states, hover effects, keyboard navigation, responsive
//
// Last Updated: 2025-11-20 (Phase 3 - Molecule Refactor)
// Version: 1.0.0 (ITCSS + BEM)
//
// BEM Structure:
// Block: .c-navigation
// Elements: __list, __item, __link, __link-text, __link-icon, __dropdown, __dropdown-item, __dropdown-link
// Modifiers: --dropdown, --active, --open, --end
//

/*------------------------------------------------------------------
  # Navigation List
-------------------------------------------------------------------*/

.c-navigation__list {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--nav-list-gap);
  list-style: none;
  margin: 0;
  padding: 0;

  // Mobile: Stack vertically
  @media (max-width: $breakpoint-md - 1) {
    flex-direction: column;
    align-items: stretch;
    gap: var(--nav-list-gap-mobile);
  }
}

/*------------------------------------------------------------------
  # Navigation Item
-------------------------------------------------------------------*/

.c-navigation__item {
  position: relative;
  margin: 0;
  padding: 0;

  // Active state (current page)
  &--active {
    > .c-navigation__link {
      color: var(--nav-link-color-active);
      font-weight: var(--nav-link-font-weight-active);
    }
  }

  // Open state (dropdown expanded)
  &--open {
    > .c-navigation__link {
      color: var(--nav-link-color-active);
    }

    > .c-navigation__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      pointer-events: auto;
    }
  }
}

/*------------------------------------------------------------------
  # Navigation Link
-------------------------------------------------------------------*/

.c-navigation__link {
  display: inline-flex;
  align-items: center;
  gap: var(--nav-link-gap);
  padding: var(--nav-link-padding);
  color: var(--nav-link-color);
  font-family: var(--nav-link-font-family);
  font-size: var(--nav-link-font-size);
  font-weight: var(--nav-link-font-weight);
  line-height: var(--nav-link-line-height);
  text-decoration: none;
  background: transparent;
  border: none;
  border-bottom: 0 !important;  // CRITICAL: Remove any border underlines
  border-radius: var(--nav-link-border-radius);
  cursor: pointer;
  transition: var(--nav-link-transition);
  position: relative;

  // CRITICAL: Prevent any pseudo-elements on the link itself
  // The underline should ONLY be on .c-navigation__link-text::after
  &::before,
  &::after {
    display: none !important;
  }

  // Hover state
  &:hover,
  &:focus {
    color: var(--nav-link-color-hover);
    text-decoration: none;
  }

  // Focus state (keyboard navigation) - smooth animation instead of outline
  &:focus {
    outline: none;
    animation: focusGlow 0.3s ease-in-out;
  }

  @keyframes focusGlow {
    0%, 100% {
      box-shadow: 0 0 0 0 transparent;
    }
    50% {
      box-shadow: 0 0 0 4px var(--nav-focus-glow-color);
    }
  }

  // Active (pressed) state
  &:active {
    transform: translateY(1px);
  }

  // Dropdown variant
  &--dropdown {
    padding-right: $space-2; // Reduce right padding for icon
  }
}

/*------------------------------------------------------------------
  # Navigation Link Text
-------------------------------------------------------------------*/

.c-navigation__link-text {
  position: relative;
  display: inline-block;

  // Golden underline effect - matches exact text width
  &::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: calc(-1 * var(--nav-link-underline-offset));
    height: var(--nav-link-underline-height);
    background: var(--nav-link-underline-color);
    opacity: 0;
    transform: scaleX(0);
    transform-origin: left;
    transition: var(--nav-link-underline-transition);
  }

  // Show underline on parent link hover/focus
  .c-navigation__link:hover &::after,
  .c-navigation__link:focus &::after {
    opacity: 1;
    transform: scaleX(1);
  }

  // Show underline on active page
  .c-navigation__item--active .c-navigation__link &::after {
    opacity: 1;
    transform: scaleX(1);
  }
}

/*------------------------------------------------------------------
  # Navigation Link Icon (Dropdown Indicator)
-------------------------------------------------------------------*/

.c-navigation__link-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: var(--nav-dropdown-transition);

  .c-navigation__item--open & {
    transform: rotate(180deg);
  }
}

/*------------------------------------------------------------------
  # Navigation Dropdown Menu
-------------------------------------------------------------------*/

.c-navigation__dropdown {
  position: absolute;
  top: calc(100% + var(--nav-dropdown-offset));
  left: 0;
  min-width: var(--nav-dropdown-min-width);
  background: var(--nav-dropdown-bg);
  @include glassmorphism($radius-md, 0.98);
  border-radius: var(--nav-dropdown-border-radius);
  box-shadow: var(--nav-dropdown-shadow);
  list-style: none;
  margin: 0;
  padding: var(--nav-dropdown-padding);
  z-index: $z-dropdown;

  // Hidden by default
  opacity: 0;
  visibility: hidden;
  transform: var(--nav-dropdown-transform);
  pointer-events: none;
  transition: var(--nav-dropdown-transition);

  // Mobile: Full width, no absolute positioning
  @media (max-width: $breakpoint-md - 1) {
    position: static;
    width: 100%;
    min-width: auto;
    transform: translateY(0);
    box-shadow: none;
    background: var(--nav-dropdown-bg-mobile);
    margin-top: var(--nav-dropdown-gap);
  }

  // Open state (added via JS)
  &--open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    pointer-events: auto;
  }

  // End-aligned variant (right-aligned for viewport edge)
  &--end {
    left: auto;
    right: 0;
  }
}

/*------------------------------------------------------------------
  # Dropdown Item
-------------------------------------------------------------------*/

.c-navigation__dropdown-item {
  margin: 0;
  padding: 0;
  list-style: none;

  &:not(:last-child) {
    margin-bottom: var(--nav-dropdown-gap);
  }
}

/*------------------------------------------------------------------
  # Dropdown Link
-------------------------------------------------------------------*/

.c-navigation__dropdown-link {
  display: block;
  padding: var(--nav-dropdown-link-padding);
  color: var(--nav-dropdown-link-color);
  font-family: var(--nav-link-font-family);
  font-size: var(--nav-dropdown-link-font-size);
  font-weight: var(--nav-dropdown-link-font-weight);
  line-height: var(--nav-link-line-height);
  text-decoration: none;
  border: none;
  border-bottom: none;
  border-radius: var(--nav-dropdown-link-border-radius);
  transition: var(--nav-link-transition);
  position: relative;

  // Hover state - slide effect (underline is on text span)
  &:hover,
  &:focus {
    color: var(--nav-dropdown-link-color-hover);
    background: transparent;
    transform: var(--nav-dropdown-link-transform-hover);
    text-decoration: none;
  }

  // Focus state (keyboard navigation) - smooth animation instead of outline
  &:focus {
    outline: none;
    animation: focusGlow 0.3s ease-in-out;
  }

  // Active state (current page within dropdown)
  &--active {
    font-weight: var(--nav-dropdown-link-font-weight-active);
    text-decoration: none;

    // Keep text decoration off on hover/focus
    &:hover,
    &:focus {
      text-decoration: none;
    }
  }
}

/*------------------------------------------------------------------
  # Dropdown Link Text
-------------------------------------------------------------------*/

.c-navigation__dropdown-link-text {
  position: relative;
  display: inline-block;

  // Golden underline effect - matches exact text width
  &::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: calc(-1 * var(--nav-dropdown-link-underline-offset));
    height: var(--nav-link-underline-height);
    background: var(--nav-link-underline-color);
    opacity: 0;
    transform: scaleX(0);
    transform-origin: left;
    transition: var(--nav-link-underline-transition);
  }

  // Show underline on parent link hover/focus
  .c-navigation__dropdown-link:hover &::after,
  .c-navigation__dropdown-link:focus &::after {
    opacity: 1;
    transform: scaleX(1);
  }
}

/*------------------------------------------------------------------
  # Responsive Behavior
-------------------------------------------------------------------*/

// Tablet: Adjust spacing
@media (min-width: $breakpoint-md) and (max-width: $breakpoint-lg - 1) {
  .c-navigation__list {
    gap: var(--nav-list-gap-tablet);
  }

  .c-navigation__link {
    padding: var(--nav-link-padding-tablet);
  }

  .c-navigation__dropdown {
    min-width: var(--nav-dropdown-min-width-tablet);
  }
}

// Large screens: Enhanced spacing
@media (min-width: $breakpoint-xl) {
  .c-navigation__list {
    gap: var(--nav-list-gap-desktop);
  }

  .c-navigation__link {
    font-size: var(--nav-link-font-size-desktop);
  }
}

/*------------------------------------------------------------------
  # Scroll State (Redesign 2025)
-------------------------------------------------------------------*/

// Parent container for navigation (header/navbar)
// Add .c-navbar--scrolled class via JavaScript when scroll > 100px
.c-navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: $z-fixed;
  background: var(--navbar-bg);
  transition: var(--navbar-transition);
  padding: var(--navbar-padding);

  // Scrolled state - glassmorphism effect (redesign 2025)
  &--scrolled {
    background: var(--navbar-bg-scrolled);
    @include glassmorphism(0, 0.95); // 0 = no border radius for navigation bar
    box-shadow: var(--navbar-shadow-scrolled);
    padding: var(--navbar-padding-scrolled);
  }

  @media (max-width: $breakpoint-md - 1) {
    position: static; // No fixed positioning on mobile
    background: var(--navbar-bg-mobile);
    box-shadow: var(--navbar-shadow-mobile);
    padding: var(--navbar-padding-mobile);
  }
}

/*------------------------------------------------------------------
  # Accessibility Enhancements
-------------------------------------------------------------------*/

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .c-navigation__link,
  .c-navigation__dropdown,
  .c-navigation__dropdown-link,
  .c-navigation__link-icon,
  .c-navbar {
    transition: none;
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .c-navigation__link {
    &:focus {
      outline-width: 3px;
    }
  }

  .c-navigation__dropdown {
    border: 2px solid currentColor;
  }
}
