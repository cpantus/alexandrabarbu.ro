/*
========================================================================
  Card System Foundation - v4.0 Card Enhancement Mixins
  Version: 4.1.0 - Design System Enhancement (TIER 0)

  Purpose: Transform flat legacy cards into v4.0 elevated cards
  Features: Glassmorphism, gradient borders, colored shadows, hover effects
========================================================================
*/

@import '../design-tokens';
@import '../design-enhancements';
@import 'color-system';

/*------------------------------------------------------------------
  # Card Enhancement Mixins
  # Transform legacy cards with v4.0 styling
-------------------------------------------------------------------*/

/**
 * Base v4.0 Card with Gradient Glow (elegant soft border)
 * Modern card with glassmorphism gradient glow effect (unified theme-wide)
 * @param {string} $variant - Color variant for glow (primary, secondary, coral, sage)
 * @param {boolean} $elevated - Whether to apply elevated shadow (default: false)
 */
@mixin card-v4($variant: 'primary', $elevated: false) {
  position: relative;
  background: $gradient-glass-light;
  @include glassmorphism($card-border-radius, 0.9);
  border-radius: $card-border-radius; // 12px (design token rule)
  padding: $card-padding; // 16px (molecule tier)
  transition: all $duration-base $easing-medium; // 400ms ease-in-out (Level 2 motion)

  // Base shadow
  @if $elevated {
    box-shadow: $card-shadow-hover; // Elevated rest state
  } @else {
    box-shadow: $card-shadow; // Subtle rest state
  }

  // Hover effect: gradient glow appears + lift
  &:hover {
    transform: translateY(-2px) scale(1.02);
    background: rgba(255, 255, 255, 0.95);

    // Variant-specific gradient glow (soft, elegant)
    @if $variant == 'primary' {
      box-shadow:
        0 0 0 1px rgba($emerald-400, 0.2),
        0 8px 24px -4px rgba($emerald-500, 0.25),
        0 16px 48px -8px rgba($emerald-400, 0.15);
    } @else if $variant == 'secondary' {
      box-shadow:
        0 0 0 1px rgba($terracotta-400, 0.2),
        0 8px 24px -4px rgba($terracotta-500, 0.25),
        0 16px 48px -8px rgba($terracotta-400, 0.15);
    } @else if $variant == 'coral' {
      box-shadow:
        0 0 0 1px rgba($coral-400, 0.2),
        0 8px 24px -4px rgba($coral-500, 0.25),
        0 16px 48px -8px rgba($coral-400, 0.15);
    } @else if $variant == 'sage' {
      box-shadow:
        0 0 0 1px rgba($sage-400, 0.2),
        0 8px 24px -4px rgba($sage-500, 0.25),
        0 16px 48px -8px rgba($sage-400, 0.15);
    } @else {
      box-shadow: $shadow-md; // Fallback
    }
  }
}

/**
 * Card with Glassmorphism
 * Frosted glass card effect with backdrop blur
 * @param {string} $variant - Color variant for tint
 * @param {number} $blur - Backdrop blur amount (default: 12px)
 * @param {number} $opacity - Background opacity (default: 0.7)
 */
@mixin card-glass($variant: 'primary', $blur: 12px, $opacity: 0.7) {
  position: relative;
  backdrop-filter: blur($blur);
  -webkit-backdrop-filter: blur($blur);
  border-radius: $card-border-radius;
  padding: $card-padding;
  transition: $card-transition;

  // Semi-transparent background with tint
  @if $variant == 'primary' {
    background: rgba(#ffffff, $opacity);
    border: 1px solid rgba($emerald-500, 0.2);
  } @else if $variant == 'secondary' {
    background: rgba(#ffffff, $opacity);
    border: 1px solid rgba($terracotta-500, 0.2);
  } @else if $variant == 'neutral' {
    background: rgba(#ffffff, $opacity);
    border: 1px solid rgba($gray-300, 0.3);
  }

  // Subtle shadow
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);

  // Hover: stronger blur + lift
  &:hover {
    backdrop-filter: blur($blur + 4px);
    -webkit-backdrop-filter: blur($blur + 4px);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15);
  }
}

/**
 * Card with Gradient Border
 * Animated gradient border effect (v4.0 premium style)
 * @param {string} $gradient - Gradient type (primary, secondary, healing)
 */
@mixin card-gradient-border($gradient: 'primary') {
  position: relative;
  background: #ffffff;
  border-radius: $card-border-radius;
  padding: $card-padding;
  transition: $card-transition;

  // Gradient border via pseudo-element
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: $card-border-radius;
    padding: 2px; // Border width
    z-index: -1;

    @if $gradient == 'primary' {
      background: linear-gradient(135deg, $emerald-400 0%, $emerald-500 100%);
    } @else if $gradient == 'secondary' {
      background: linear-gradient(135deg, $terracotta-400 0%, $terracotta-500 100%);
    } @else if $gradient == 'healing' {
      background: linear-gradient(135deg, $emerald-400 0%, $terracotta-400 100%);
    }

    // Mask to create border effect
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
  }

  // Hover: brighter gradient + lift
  &:hover {
    transform: translateY(-4px);
    box-shadow: $shadow-md;

    &::before {
      @if $gradient == 'primary' {
        background: linear-gradient(135deg, $emerald-300 0%, $emerald-600 100%);
      } @else if $gradient == 'secondary' {
        background: linear-gradient(135deg, $terracotta-300 0%, $terracotta-600 100%);
      } @else if $gradient == 'healing' {
        background: linear-gradient(135deg, $emerald-300 0%, $terracotta-300 100%);
      }
    }
  }
}

/**
 * Card with Top Border Accent
 * Colored top border (3px) with matching icon/shadow
 * @param {string} $variant - Color variant (primary, secondary, coral, sage)
 */
@mixin card-top-accent($variant: 'primary') {
  @include card-v4($variant, false);

  // Thick top border
  border-top: 3px solid;
  @if $variant == 'primary' {
    border-top-color: $emerald-500;
  } @else if $variant == 'secondary' {
    border-top-color: $terracotta-500;
  } @else if $variant == 'coral' {
    border-top-color: $coral-500;
  } @else if $variant == 'sage' {
    border-top-color: $sage-500;
  }

  // Icon color matches border
  .card-icon,
  .icon-circle {
    @if $variant == 'primary' {
      background: linear-gradient(135deg, $emerald-400 0%, $emerald-500 100%);
    } @else if $variant == 'secondary' {
      background: linear-gradient(135deg, $terracotta-400 0%, $terracotta-500 100%);
    } @else if $variant == 'coral' {
      background: linear-gradient(135deg, $coral-400 0%, $coral-500 100%);
    } @else if $variant == 'sage' {
      background: linear-gradient(135deg, $sage-400 0%, $sage-500 100%);
    }
  }
}

/**
 * Card with Hover Lift Animation
 * Pronounced lift effect with shadow growth
 * @param {number} $lift - Lift distance in pixels (default: -8px)
 */
@mixin card-hover-lift($lift: -8px) {
  transition: transform $duration-fast $ease-out,
              box-shadow $duration-fast $ease-out;

  &:hover {
    transform: translateY($lift);
    box-shadow: $shadow-lg;
  }
}

/**
 * Card with Gradient Background
 * Full card background gradient (subtle, not overwhelming)
 * @param {string} $variant - Gradient variant (primary-subtle, secondary-subtle, light)
 */
@mixin card-gradient-bg($variant: 'primary-subtle') {
  border-radius: $card-border-radius;
  padding: $card-padding;
  transition: $card-transition;
  border: 1px solid rgba(#ffffff, 0.3);

  @if $variant == 'primary-subtle' {
    background: linear-gradient(135deg, $emerald-50 0%, #ffffff 100%);
  } @else if $variant == 'secondary-subtle' {
    background: linear-gradient(135deg, $terracotta-50 0%, #ffffff 100%);
  } @else if $variant == 'light' {
    background: linear-gradient(135deg, $gray-50 0%, #ffffff 100%);
  }

  box-shadow: $card-shadow;

  &:hover {
    box-shadow: $card-shadow-hover;
    transform: translateY(-4px);
  }
}

/*------------------------------------------------------------------
  # Card Component Classes
  # Ready-to-use card wrapper classes
-------------------------------------------------------------------*/

/**
 * Standard v4.0 Cards (4 color variants)
 */
.card-v4 {
  @include card-v4('primary', false);

  &.card-primary { @include card-v4('primary', false); }
  &.card-secondary { @include card-v4('secondary', false); }
  &.card-coral { @include card-v4('coral', false); }
  &.card-sage { @include card-v4('sage', false); }

  &.card-elevated {
    @include card-v4('primary', true);
  }
}

/**
 * Glassmorphism Cards
 */
.card-glass {
  @include card-glass('primary', 12px, 0.7);

  &.card-secondary { @include card-glass('secondary', 12px, 0.7); }
  &.card-neutral { @include card-glass('neutral', 12px, 0.7); }

  &.card-glass-strong {
    @include card-glass('primary', 20px, 0.8); // Stronger blur
  }
}

/**
 * Gradient Border Cards
 */
.card-gradient-border {
  @include card-gradient-border('primary');

  &.card-secondary { @include card-gradient-border('secondary'); }
  &.card-healing { @include card-gradient-border('healing'); }
}

/**
 * Top Accent Cards (service-highlights, related-services style)
 */
.card-top-accent {
  @include card-top-accent('primary');

  &.card-secondary { @include card-top-accent('secondary'); }
  &.card-coral { @include card-top-accent('coral'); }
  &.card-sage { @include card-top-accent('sage'); }
}

/**
 * Hover Lift Cards
 */
.card-hover-lift {
  @include card-v4('primary', false);
  @include card-hover-lift(-8px);

  &.card-lift-small { @include card-hover-lift(-4px); }
  &.card-lift-large { @include card-hover-lift(-12px); }
}

/**
 * Gradient Background Cards
 */
.card-gradient-bg {
  @include card-gradient-bg('primary-subtle');

  &.card-secondary { @include card-gradient-bg('secondary-subtle'); }
  &.card-light { @include card-gradient-bg('light'); }
}

/*------------------------------------------------------------------
  # Auto-Color Card Distribution (nth-child fallback)
  # Applied when no explicit variant specified
-------------------------------------------------------------------*/

/**
 * Service Cards - Alternating primary/secondary
 */
.services-grid,
.related-services-section {
  .service-card:not([class*="card-"]) {
    &:nth-child(odd) { @include card-top-accent('primary'); }
    &:nth-child(even) { @include card-top-accent('secondary'); }
  }
}

/**
 * Feature Cards - 4-color rotation
 */
.features-grid,
.benefits-grid {
  .feature-card:not([class*="card-"]),
  .benefit-card:not([class*="card-"]) {
    &:nth-child(4n+1) { @include card-top-accent('primary'); }
    &:nth-child(4n+2) { @include card-top-accent('secondary'); }
    &:nth-child(4n+3) { @include card-top-accent('coral'); }
    &:nth-child(4n+4) { @include card-top-accent('sage'); }
  }
}

/**
 * Blog Cards - Alternating elevated/standard
 */
.blog-grid {
  .blog-card:not([class*="card-"]) {
    &:nth-child(odd) { @include card-v4('primary', false); }
    &:nth-child(even) { @include card-v4('primary', true); }
  }
}

/**
 * Testimonial Cards - Gradient backgrounds
 */
.testimonials-grid {
  .testimonial-card:not([class*="card-"]) {
    &:nth-child(3n+1) { @include card-gradient-bg('primary-subtle'); }
    &:nth-child(3n+2) { @include card-gradient-bg('secondary-subtle'); }
    &:nth-child(3n+3) { @include card-gradient-bg('light'); }
  }
}

/*------------------------------------------------------------------
  # Card Content Enhancement
  # Styling for card interior elements
-------------------------------------------------------------------*/

/**
 * Card Header (title + icon)
 */
.card-header {
  display: flex;
  align-items: center;
  gap: $space-3;
  margin-bottom: $space-4;

  .card-icon {
    flex-shrink: 0;
  }

  .card-title {
    font-family: $font-primary;
    font-size: $text-xl;
    font-weight: $weight-semibold;
    color: $gray-900;
    margin: 0;
  }
}

/**
 * Card Body (main content)
 */
.card-body {
  color: $gray-600;
  font-size: $text-base;
  line-height: $leading-relaxed;
  margin-bottom: $space-4;

  p:last-child {
    margin-bottom: 0;
  }
}

/**
 * Card Footer (actions, metadata)
 */
.card-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: $space-4;
  padding-top: $space-4;
  border-top: 1px solid $gray-200;

  .card-meta {
    font-size: $text-sm;
    color: $gray-500;
  }

  .card-action {
    font-size: $text-sm;
    font-weight: $weight-semibold;
    color: $emerald-600;
    text-decoration: none;
    transition: color $duration-fast $ease-out;

    &:hover {
      color: $emerald-700;
      text-decoration: underline;
    }
  }
}

/*------------------------------------------------------------------
  # Card Grid Layouts
  # Responsive grid systems for cards
-------------------------------------------------------------------*/

/**
 * 2-Column Card Grid (default)
 */
.card-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: $space-6;

  @media (min-width: $breakpoint-md) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-lg) {
    gap: $space-8;
  }
}

/**
 * 3-Column Card Grid
 */
.card-grid-3 {
  @extend .card-grid;

  @media (min-width: $breakpoint-lg) {
    grid-template-columns: repeat(3, 1fr);
  }
}

/**
 * 4-Column Card Grid
 */
.card-grid-4 {
  @extend .card-grid;

  @media (min-width: $breakpoint-md) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-lg) {
    grid-template-columns: repeat(4, 1fr);
  }
}

/**
 * Masonry Card Grid (Pinterest-style)
 */
.card-grid-masonry {
  display: grid;
  grid-template-columns: 1fr;
  gap: $space-6;

  @media (min-width: $breakpoint-md) {
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: auto;
  }

  @media (min-width: $breakpoint-lg) {
    grid-template-columns: repeat(3, 1fr);
  }
}

/*
========================================================================
  END Card System Foundation

  Usage Summary:
  1. Mixins: @include card-v4(), card-glass(), card-gradient-border(), card-top-accent()
  2. Classes: .card-v4, .card-glass, .card-gradient-border, .card-top-accent
  3. Variants: .card-primary, .card-secondary, .card-coral, .card-sage
  4. Elevations: .card-elevated, .card-hover-lift
  5. Gradients: .card-gradient-bg, .card-gradient-border
  6. Auto-Distribution: Automatic color rotation via nth-child selectors
  7. Layouts: .card-grid, .card-grid-3, .card-grid-4, .card-grid-masonry

  Integration: Import this file in custom.scss AFTER color-system.scss and icon-system.scss
========================================================================
*/
