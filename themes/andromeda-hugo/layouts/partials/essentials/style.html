<!-- DNS preconnect -->
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="preconnect" href="//ajax.googleapis.com" />
<!-- Removed preconnect to fonts.gstatic.com - fonts are now self-hosted -->
<link rel="preconnect" href="//cdnjs.cloudflare.com" />
<link rel="preconnect" href="//www.googletagmanager.com" />
<link rel="preconnect" href="//www.google-analytics.com" />
<!-- Removed dns-prefetch to fonts.gstatic.com - fonts are now self-hosted -->
<link rel="dns-prefetch" href="//ajax.googleapis.com" />
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
<link rel="dns-prefetch" href="//www.googletagmanager.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<!-- Removed dns-prefetch to fonts.googleapis.com - fonts are now self-hosted -->
<link rel="dns-prefetch" href="//connect.facebook.net" />
<link rel="dns-prefetch" href="//platform.linkedin.com" />
<link rel="dns-prefetch" href="//platform.twitter.com" />

<!-- Self-hosted fonts - loaded async to eliminate render-blocking -->
<!-- fonts.css: Google Fonts (Playfair Display + DM Sans) -->
<link rel="preload" href="/css/fonts.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="/css/fonts.css"></noscript>

<!-- line-awesome: Icon fonts - loaded async -->
<link rel="preload" href="/css/line-awesome.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="/css/line-awesome.min.css"></noscript>

<!-- plugins + stylesheet -->
{{ $styles := slice }}
{{ range site.Params.plugins.css }}
  {{ if findRE "^http" .link }}
    <link
      crossorigin="anonymous"
      media="all"
      rel="stylesheet"
      href="{{ .link | relURL }}"
      {{ .attributes | safeHTMLAttr }} />
  {{ else }}
    {{ $resource := resources.Get .link }}
    {{ if $resource }}
      {{ if strings.HasSuffix .link ".scss" }}
        {{ $styles = $styles | append ($resource | toCSS) }}
      {{ else }}
        {{ $styles = $styles | append $resource }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
{{/* Process main-new.scss as template to inject design tokens from design.toml */}}
{{/* Note: main-new.scss contains inlined config bridge code with Hugo template syntax */}}
{{ $mainStyle := resources.Get "scss/main-new.scss" | resources.ExecuteAsTemplate "main-new.scss" . | toCSS }}
{{ $styles = $styles | append $mainStyle }}
{{ $styles = $styles | resources.Concat "/css/style.css" | fingerprint "sha512" }}


<!-- Purge CSS in Production -->
{{ if and hugo.IsProduction site.Params.purge_css }}
  {{ $styles = $styles | css.PostCSS | fingerprint "sha256" }}
  {{ $styles = $styles | resources.PostProcess }}
{{ end }}

{{/* ============================================================
    CRITICAL CSS - Inlined for instant first paint (no FOUC)
    Contains: header, buttons, container, typography base
    Target: <20KB minified
    ============================================================ */}}
{{- $criticalSCSS := resources.Get "scss/critical.scss" -}}
{{- $criticalCSS := $criticalSCSS | resources.ExecuteAsTemplate "critical.scss" . | toCSS (dict "outputStyle" "compressed") -}}
<style>{{ $criticalCSS.Content | safeCSS }}</style>

<!-- Full CSS - async loaded (non-blocking) for better Core Web Vitals -->
<!-- Uses media="print" trick: browser downloads but doesn't block rendering -->
<!-- onload switches to media="all" once fully loaded -->
<link rel="stylesheet" href="{{ $styles.RelPermalink }}"
      integrity="{{ $styles.Data.Integrity }}"
      media="print"
      onload="this.media='all';this.onload=null;">
<noscript><link rel="stylesheet" href="{{ $styles.RelPermalink }}"></noscript>
