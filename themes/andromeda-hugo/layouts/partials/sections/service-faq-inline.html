{{/*
  Service FAQ Inline Section - Service-specific frequently asked questions with rich features

  Usage:
    sections:
      - type: "service-faq-inline"

    service_faq:
      title: "Frequently Asked Questions"
      subtitle: "COMMON QUESTIONS"
      description: "Find answers to common questions about this service."
      variant: "primary"
      questions:
        - icon: "question-circle"
          question: "How long are sessions?"
          answer: "Sessions typically last 50 minutes."
          badge: "Most Asked"
          highlights:
            - "Individual sessions: 50 min"
            - "Couples sessions: 80 min"
          note: "First session may be longer for assessment."
      contact_note:
        text: "Still have questions? We're here to help."
        icon: "phone"
        variant: "tip"
        cta:
          text: "Contact Us"
          url: "/contact"
          icon: "arrow-right"

  Parameters:
    title (optional) - Section title
    subtitle (optional) - Section subtitle/eyebrow
    description (optional) - Section description
    variant (optional) - Color variant: primary|secondary|tertiary|neutral (default: "primary")
    questions (required) - Array of FAQ items:
      - icon (optional) - Icon name for question
      - question (required) - Question text
      - answer (required) - Answer text (supports markdown)
      - badge (optional) - Badge text (e.g., "New", "Popular")
      - highlights (optional) - Array of highlight bullet points
      - note (optional) - Additional note/disclaimer
    contact_note (optional) - Contact note object:
      - text (required) - Note message
      - icon (optional) - Icon name (default: "question-circle")
      - variant (optional) - info-box variant: tip|note|warning|important|success (default: "tip")
      - cta (optional) - Call to action button:
        - text (required) - Button text
        - url (required) - Button URL
        - icon (optional) - Button icon
        - variant (optional) - Button variant (default: inherits section variant)

  BEM Structure:
    .c-service-faq                Block
    .c-service-faq--primary       Modifier: color variant
    .c-service-faq__header        Element: section header
    .c-service-faq__accordion     Element: accordion container
    .c-service-faq__item          Element: single FAQ item
    .c-service-faq__question      Element: question button
    .c-service-faq__answer        Element: answer content
    .c-service-faq__contact       Element: contact note wrapper

  Version: 2.0.0 (BEM refactor, molecule composition)
  Last Updated: 2025-11-20
*/}}

{{- /* ========================================
     PARAMETER EXTRACTION & VALIDATION
     ======================================== */ -}}
{{- $section := .Params.service_faq -}}
{{- if not $section -}}
  {{- return -}}
{{- end -}}

{{- $title := $section.title | default "" -}}
{{- $subtitle := $section.subtitle | default "" -}}
{{- $description := $section.description | default "" -}}
{{- $variant := $section.variant | default "primary" -}}
{{- $questions := $section.questions | default slice -}}
{{- $contactNote := $section.contact_note -}}

{{- /* Validate variant */ -}}
{{- $validVariants := slice "primary" "secondary" "tertiary" "neutral" -}}
{{- if not (in $validVariants $variant) -}}
  {{- warnf "service-faq-inline: invalid variant '%s'. Using 'primary'. Valid: %s" $variant (delimit $validVariants ", ") -}}
  {{- $variant = "primary" -}}
{{- end -}}

{{- /* Validate required questions */ -}}
{{- if not $questions -}}
  {{- warnf "service-faq-inline: 'questions' array is empty. Section will not render FAQ." -}}
{{- end -}}

{{- /* ========================================
     SECTION ID & BEM CLASSES
     ======================================== */ -}}
{{- $sectionID := printf "service-faq-%d" (now.Unix) -}}
{{- $blockClass := "c-service-faq" -}}
{{- $modifiers := slice (printf "c-service-faq--%s" $variant) -}}
{{- $allClasses := delimit (append (slice $blockClass) $modifiers) " " -}}

{{- /* ========================================
     SECTION MARKUP
     ======================================== */ -}}
<section class="{{ $allClasses }}" id="{{ $sectionID }}">
  <div class="o-container">

    {{- /* ========================================
         SECTION HEADER
         ======================================== */ -}}
    {{- if or $title $subtitle $description -}}
    <div class="c-service-faq__header">
      {{- if $subtitle -}}
        <p class="c-service-faq__subtitle">{{ $subtitle }}</p>
      {{- end -}}

      {{- if $title -}}
        {{ partial "atoms/heading.html" (dict
          "text" $title
          "level" 2
          "variant" $variant
          "class" "c-service-faq__title"
        ) }}
      {{- end -}}

      {{- if $description -}}
        <p class="c-service-faq__description">{{ $description }}</p>
      {{- end -}}
    </div>
    {{- end -}}

    {{- /* ========================================
         ACCORDION (Vanilla JS with custom markup)
         ======================================== */ -}}
    {{- if $questions -}}
    <div class="c-service-faq__accordion" id="{{ $sectionID }}-accordion">
      {{- range $index, $item := $questions -}}
        {{- $itemID := printf "%s-item-%d" $sectionID $index -}}
        {{- $panelID := printf "%s-panel-%d" $sectionID $index -}}
        {{- $isFirst := eq $index 0 -}}

        <div class="c-service-faq__item{{ if $isFirst }} c-service-faq__item--active{{ end }}">
          {{- /* Question Button */ -}}
          <button
            class="c-service-faq__question"
            type="button"
            data-toggle="collapse"
            data-target="#{{ $panelID }}"
            data-parent="#{{ $sectionID }}-accordion"
            aria-expanded="{{ if $isFirst }}true{{ else }}false{{ end }}"
            aria-controls="{{ $panelID }}"
            id="{{ $itemID }}-button"
          >
            {{- /* Icon (optional) */ -}}
            {{- if $item.icon -}}
              <span class="c-service-faq__question-icon">
                {{ partial "atoms/icon.html" (dict "name" $item.icon "size" "md" "variant" $variant) }}
              </span>
            {{- end -}}

            {{- /* Question Text */ -}}
            <span class="c-service-faq__question-text">{{ $item.question }}</span>

            {{- /* Badge (optional) */ -}}
            {{- if $item.badge -}}
              <span class="c-service-faq__question-badge">
                {{ partial "atoms/tag.html" (dict "text" $item.badge "variant" $variant "size" "sm") }}
              </span>
            {{- end -}}

            {{- /* Chevron Icon */ -}}
            <span class="c-service-faq__question-chevron">
              {{ partial "atoms/icon.html" (dict "name" "angle-down" "size" "sm") }}
            </span>
          </button>

          {{- /* Answer Panel */ -}}
          <div
            class="c-service-faq__answer collapse{{ if $isFirst }} show{{ end }}"
            id="{{ $panelID }}"
            aria-labelledby="{{ $itemID }}-button"
            role="region"
          >
            <div class="c-service-faq__answer-content">
              {{- /* Main Answer */ -}}
              {{- if $item.answer -}}
                <div class="c-service-faq__answer-text">{{ $item.answer | markdownify }}</div>
              {{- end -}}

              {{- /* Highlights (bulleted list) */ -}}
              {{- if $item.highlights -}}
                <ul class="c-service-faq__answer-highlights">
                  {{- range $item.highlights -}}
                    <li class="c-service-faq__answer-highlight-item">
                      {{ partial "atoms/icon.html" (dict "name" "check-circle" "size" "sm" "variant" "success") }}
                      <span>{{ . }}</span>
                    </li>
                  {{- end -}}
                </ul>
              {{- end -}}

              {{- /* Note (italic disclaimer) */ -}}
              {{- if $item.note -}}
                <div class="c-service-faq__answer-note">
                  {{ partial "atoms/icon.html" (dict "name" "info-circle" "size" "sm" "variant" $variant) }}
                  <span>{{ $item.note }}</span>
                </div>
              {{- end -}}
            </div>
          </div>
        </div>
      {{- end -}}
    </div>
    {{- end -}}

    {{- /* ========================================
         CONTACT NOTE (using info-box molecule)
         ======================================== */ -}}
    {{- if $contactNote -}}
    <div class="c-service-faq__contact">
      {{- /* Handle $contactNote as either string or object */ -}}
      {{- $noteType := "tip" -}}
      {{- $noteIcon := "question-circle" -}}
      {{- $noteContent := $contactNote -}}
      {{- if reflect.IsMap $contactNote -}}
        {{- $noteType = default "tip" $contactNote.variant -}}
        {{- $noteIcon = default "question-circle" $contactNote.icon -}}
        {{- $noteContent = $contactNote.text -}}
      {{- end -}}
      {{ partial "molecules/info-box.html" (dict
        "type" $noteType
        "icon" $noteIcon
        "content" $noteContent
        "centered" true
      ) }}

      {{- /* Optional CTA Button (only if contactNote is an object with cta) */ -}}
      {{- if and (reflect.IsMap $contactNote) $contactNote.cta -}}
        <div class="c-service-faq__contact-cta">
          {{ partial "atoms/button.html" (dict
            "text" $contactNote.cta.text
            "url" $contactNote.cta.url
            "variant" (default $variant $contactNote.cta.variant)
            "icon" $contactNote.cta.icon
          ) }}
        </div>
      {{- end -}}
    </div>
    {{- end -}}

  </div>
</section>
