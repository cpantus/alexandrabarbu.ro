{{/*
  First Session Timeline Section - What to expect in your first therapy session

  Usage:
    sections:
      - type: "first-session-timeline"

    first_session_timeline:
      title: "What to Expect in Your First Session"
      subtitle: "YOUR FIRST VISIT"
      description: "Understanding what happens during your initial consultation."
      variant: "primary"
      steps:
        - icon: "calendar-check"
          title: "Welcome & Introduction"
          description: "We'll start with a warm welcome and brief introductions."
          duration: "5 min"
          highlights:
            - "Meet your therapist"
            - "Tour of the office"
      reassurance:
        text: "Remember: The first session is about getting to know each other. There's no pressure to share everything at once."
        icon: "heart"
        variant: "info"
      cta:
        text: "Schedule Your First Session"
        url: "/contact"
        icon: "calendar-plus"

  Parameters:
    title (optional) - Section title
    subtitle (optional) - Section subtitle/eyebrow
    description (optional) - Section description
    variant (optional) - Color variant for section header: primary|secondary|tertiary|neutral (default: "primary")
    steps (required) - Array of timeline step objects:
      - icon (optional) - Icon name for step
      - title (required) - Step title
      - description (optional) - Step description (supports markdown)
      - duration (optional) - Duration text (e.g., "10 min")
      - highlights (optional) - Array of highlight items
    reassurance (optional) - Reassurance note object:
      - text (required) - Reassurance message
      - icon (optional) - Icon name (default: "heart")
      - variant (optional) - info-box variant: tip|note|warning|important|success (default: "tip")
    cta (optional) - Call to action button:
      - text (required) - Button text
      - url (required) - Button URL
      - icon (optional) - Button icon
      - variant (optional) - Button variant (default: inherits section variant)

  BEM Structure:
    .c-first-session-timeline           Block
    .c-first-session-timeline--primary  Modifier: color variant
    .c-first-session-timeline__header   Element: section header
    .c-first-session-timeline__timeline Element: timeline container
    .c-first-session-timeline__cta      Element: CTA wrapper

  Version: 2.0.0 (BEM refactor, molecule composition)
  Last Updated: 2025-11-20
*/}}

{{- /* ========================================
     PARAMETER EXTRACTION & VALIDATION
     ======================================== */ -}}
{{- $section := .Params.first_session_timeline -}}
{{- if not $section -}}
  {{- return -}}
{{- end -}}

{{- $title := $section.title | default "" -}}
{{- $subtitle := $section.subtitle | default "" -}}
{{- $description := $section.description | default "" -}}
{{- $variant := $section.variant | default "primary" -}}
{{- $steps := $section.steps | default slice -}}
{{- $reassurance := $section.reassurance -}}
{{- $cta := $section.cta -}}

{{- /* Validate variant */ -}}
{{- $validVariants := slice "primary" "secondary" "tertiary" "neutral" -}}
{{- if not (in $validVariants $variant) -}}
  {{- warnf "first-session-timeline: invalid variant '%s'. Using 'primary'. Valid: %s" $variant (delimit $validVariants ", ") -}}
  {{- $variant = "primary" -}}
{{- end -}}

{{- /* Validate required steps */ -}}
{{- if not $steps -}}
  {{- warnf "first-session-timeline: 'steps' array is empty. Section will not render timeline." -}}
{{- end -}}

{{- /* ========================================
     SECTION ID & BEM CLASSES
     ======================================== */ -}}
{{- $sectionID := printf "first-session-%d" (now.Unix) -}}
{{- $blockClass := "c-first-session-timeline" -}}
{{- $modifiers := slice (printf "c-first-session-timeline--%s" $variant) -}}
{{- $allClasses := delimit (append (slice $blockClass) $modifiers) " " -}}

{{- /* ========================================
     SECTION MARKUP
     ======================================== */ -}}
<section class="{{ $allClasses }}" id="{{ $sectionID }}">
  <div class="o-container">

    {{- /* ========================================
         SECTION HEADER
         ======================================== */ -}}
    {{- if or $title $subtitle $description -}}
    <div class="c-first-session-timeline__header">
      {{- if $subtitle -}}
        <p class="c-first-session-timeline__subtitle">{{ $subtitle }}</p>
      {{- end -}}

      {{- if $title -}}
        {{ partial "atoms/heading.html" (dict
          "text" $title
          "level" 2
          "variant" $variant
          "class" "c-first-session-timeline__title"
        ) }}
      {{- end -}}

      {{- if $description -}}
        <p class="c-first-session-timeline__description">{{ $description }}</p>
      {{- end -}}
    </div>
    {{- end -}}

    {{- /* ========================================
         TIMELINE (using timeline-step molecules)
         ======================================== */ -}}
    {{- if $steps -}}
    <div class="c-first-session-timeline__timeline">
      {{- range $index, $step := $steps -}}
        {{- /* Color rotation for visual variety */ -}}
        {{- $colorVariants := slice "primary" "secondary" "coral" -}}
        {{- $colorIndex := mod $index (len $colorVariants) -}}
        {{- $stepVariant := index $colorVariants $colorIndex -}}

        {{- /* Use timeline-step molecule */ -}}
        {{ partial "molecules/timeline-step.html" (dict
          "index" $index
          "icon" $step.icon
          "title" $step.title
          "description" $step.description
          "duration" $step.duration
          "highlights" $step.highlights
          "variant" $stepVariant
          "layout" "standard"
        ) }}
      {{- end -}}
    </div>
    {{- end -}}

    {{- /* ========================================
         REASSURANCE NOTE (using info-box molecule)
         ======================================== */ -}}
    {{- if $reassurance -}}
    <div class="c-first-session-timeline__reassurance">
      {{- /* Handle $reassurance as either string or object */ -}}
      {{- $reassType := "tip" -}}
      {{- $reassIcon := "heart" -}}
      {{- $reassContent := $reassurance -}}
      {{- if reflect.IsMap $reassurance -}}
        {{- $reassType = default "tip" $reassurance.variant -}}
        {{- $reassIcon = default "heart" $reassurance.icon -}}
        {{- $reassContent = $reassurance.text -}}
      {{- end -}}
      {{ partial "molecules/info-box.html" (dict
        "type" $reassType
        "icon" $reassIcon
        "content" $reassContent
        "centered" true
      ) }}
    </div>
    {{- end -}}

    {{- /* ========================================
         CALL TO ACTION
         ======================================== */ -}}
    {{- if $cta -}}
    <div class="c-first-session-timeline__cta">
      {{ partial "atoms/button.html" (dict
        "text" $cta.text
        "url" $cta.url
        "variant" (default $variant $cta.variant)
        "icon" $cta.icon
      ) }}
    </div>
    {{- end -}}

  </div>
</section>
