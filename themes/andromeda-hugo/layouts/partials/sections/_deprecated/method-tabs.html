{{/* Method Tabs Section - Therapeutic methods with tab navigation */}}
{{ $section := .Params.method_tabs }}

{{ with $section }}
  {{ if .enable }}
    <section class="section method-tabs">
      <div class="container-xxl position-relative">
        <div class="row">
          <div class="col-lg-12">
            {{/* Section Title */}}
            {{ if or .subtitle .title .description }}
              <div class="section-title text-center mb-5">
                {{ if .subtitle }}
                  <p class="text-uppercase text-muted">{{ .subtitle | markdownify }}</p>
                {{ end }}
                {{ with .title }}
                  {{- $headingVariant := $section.heading_color_variant | default "primary" -}}
                  {{ partial "atoms/heading.html" (dict "text" . "level" 2 "markdown" true "colorVariant" $headingVariant) }}
                {{ end }}
                {{ with .description }}
                  <p>{{ . | markdownify }}</p>
                {{ end }}
              </div>
            {{ end }}

            <div class="methods-tabs-wrapper">
              {{/* Tab Navigation */}}
              <ul class="nav nav-pills nav-justified mb-4" id="methodTabs" role="tablist">
                {{ range $index, $method := .methods }}
                  {{- /* 3-color rotation for tabs: primary → secondary → coral */ -}}
                  {{- $tabVariants := slice "primary" "secondary" "coral" -}}
                  {{- $tabVariant := index $tabVariants (mod $index 3) -}}

                  <li class="nav-item" role="presentation">
                    <button class="nav-link nav-link-{{ $tabVariant }} {{ if eq $index 0 }}active{{ end }}"
                            id="method-tab-{{ $index }}"
                            data-bs-toggle="pill"
                            data-bs-target="#method-{{ $index }}"
                            type="button"
                            role="tab"
                            aria-controls="method-{{ $index }}"
                            aria-selected="{{ if eq $index 0 }}true{{ else }}false{{ end }}">
                      {{ if .icon }}
                        {{/* v4.0+ gradient circle wrapper for visual consistency */}}
                        {{ partial "atoms/icon.html" (dict
                          "name" .icon
                          "withWrapper" true
                          "wrapperVariant" $tabVariant
                          "wrapperSize" "sm"
                          "class" "me-2"
                        ) }}
                      {{ end }}
                      {{ .short_name | default .name | default .title }}
                    </button>
                  </li>
                {{ end }}
              </ul>

              {{/* Tab Content */}}
              <div class="tab-content" id="methodTabsContent">
                {{ range $index, $method := .methods }}
                  <div class="tab-pane fade {{ if eq $index 0 }}show active{{ end }}"
                       id="method-{{ $index }}"
                       role="tabpanel"
                       aria-labelledby="method-tab-{{ $index }}">
                    <div class="card border-0 shadow-sm card-v4">
                      <div class="card-body p-5">
                        {{ partial "atoms/heading.html" (dict "text" (.title | default .name) "level" 3 "class" "mb-3") }}
                        {{ with .description }}
                          <p class="lead">{{ . | markdownify }}</p>
                        {{ end }}

                        {{ with .what_is }}
                          {{ partial "atoms/heading.html" (dict "text" (i18n "what_is" | default "Ce este?") "level" 5 "variant" "primary" "class" "mt-4") }}
                          <p>{{ . | markdownify }}</p>
                        {{ end }}

                        {{ with .how_works }}
                          {{ partial "atoms/heading.html" (dict "text" (i18n "how_it_works" | default "Cum funcționează?") "level" 5 "variant" "primary" "class" "mt-4") }}
                          <p>{{ . | markdownify }}</p>
                        {{ end }}

                        {{ with (or .for_what .benefits .best_for) }}
                          {{ partial "atoms/heading.html" (dict "text" (i18n "benefits" | default "Beneficii") "level" 5 "variant" "primary" "class" "mt-4") }}
                          <ul class="list-unstyled check-list-2">
                            {{ range . }}
                              <li class="mb-2">
                                {{ partial "atoms/icon.html" (dict "name" "check" "color" "primary" "class" "me-2") }}{{ . | markdownify }}
                              </li>
                            {{ end }}
                          </ul>
                        {{ end }}

                        {{ with .techniques }}
                          {{ partial "atoms/heading.html" (dict "text" (i18n "techniques" | default "Tehnici") "level" 5 "variant" "primary" "class" "mt-4") }}
                          <ul class="list-unstyled">
                            {{ range . }}
                              <li class="mb-2">
                                {{ partial "atoms/icon.html" (dict "name" "arrow-right" "color" "secondary" "class" "me-2") }}{{ . | markdownify }}
                              </li>
                            {{ end }}
                          </ul>
                        {{ end }}

                        {{ with .duration }}
                          <p class="mt-3"><strong>{{ i18n "duration" | default "Durata" }}:</strong> {{ . }}</p>
                        {{ end }}
                        {{ with .success_rate }}
                          <p><strong>{{ i18n "success_rate" | default "Rată de succes" }}:</strong> {{ . }}</p>
                        {{ end }}
                      </div>
                    </div>
                  </div>
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  {{ end }}
{{ end }}
