{{- /*
  Confidentiality Notice Section

  Description:
    Displays formal/legal confidentiality information with guarantee notices,
    limitations, and exceptions. Uses info-box molecules for key points and
    a warning-styled box for confidentiality limits.

  BEM Structure:
    - Block: .c-confidentiality-notice
    - Elements: __header, __subtitle, __intro, __notices, __limits, __limits-title, __limits-list, __link
    - Modifiers: --primary, --secondary, --tertiary, --neutral

  Front Matter Structure:
    confidentiality_notice:
      variant: "primary"                    # Optional: primary (default), secondary, tertiary, neutral
      title: "Your Privacy is Protected"    # Required: Section title
      subtitle: "Confidentiality Guaranteed" # Optional: Section subtitle
      intro: "All communications protected..." # Optional: Intro paragraph(s) (array or string)
      notices:                              # Optional: Info boxes
        - type: "tip"                       # Required: tip, note, warning, important, success
          title: "Professional Secrecy"     # Optional: Box title
          content: "Protected by law..."    # Required: Box content
      limits:                               # Optional: Confidentiality limits/exceptions
        title: "Exceptions to Confidentiality" # Optional: Limits title (default: i18n)
        items:                              # Required if limits present: Array of limit items
          - "Imminent danger to self or others"
          - "Court order or subpoena"
          - "Suspected child/elder abuse"
      link:                                 # Optional: Link to full policy
        text: "Read Full Privacy Policy"    # Required if link present
        url: "/privacy/"                    # Required if link present

  Dependencies:
    - Molecules: info-box.html
    - Atoms: heading.html, link.html, icon.html
    - SCSS: _confidentiality-notice.scss

  Accessibility:
    - Semantic HTML with article elements
    - Heading hierarchy (h2 for title)
    - ARIA labels for icons
    - Focus indicators via CSS

  Version: 1.0.0
  Last Updated: 2025-11-20
*/ -}}

{{- /* Extract Section Data */ -}}
{{- $section := .Params.confidentiality_notice -}}

{{- /* Only render if section exists */ -}}
{{- with $section -}}

  {{- /* Section Parameters */ -}}
  {{- $variant := .variant | default "primary" -}}
  {{- $title := .title -}}
  {{- $subtitle := .subtitle -}}
  {{- $intro := .intro -}}
  {{- $notices := .notices -}}
  {{- $limits := .limits -}}
  {{- $link := .link -}}

  {{- /* Validation */ -}}
  {{- if not $title -}}
    {{- warnf "confidentiality-notice: 'title' parameter is required (page: %s)" $.Page.File.Path -}}
  {{- end -}}

  {{- /* Valid Variants */ -}}
  {{- $valid_variants := slice "primary" "secondary" "tertiary" "neutral" -}}
  {{- if not (in $valid_variants $variant) -}}
    {{- warnf "confidentiality-notice: Invalid variant '%s'. Using 'primary'. Valid: %s (page: %s)" $variant (delimit $valid_variants ", ") $.Page.File.Path -}}
    {{- $variant = "primary" -}}
  {{- end -}}

  {{- /* Build Modifier Class */ -}}
  {{- $modifier_class := printf "c-confidentiality-notice--%s" $variant -}}

  <section class="c-confidentiality-notice {{ $modifier_class }}">
    <div class="o-container">

      {{- /* Section Header */ -}}
      {{- if or $title $subtitle -}}
        <div class="c-confidentiality-notice__header">
          {{- /* Title */ -}}
          {{- if $title -}}
            {{ partial "atoms/heading.html" (dict
              "level" 2
              "text" ($title | markdownify)
              "variant" $variant
            ) }}
          {{- end -}}

          {{- /* Subtitle */ -}}
          {{- if $subtitle -}}
            <p class="c-confidentiality-notice__subtitle">{{ $subtitle | markdownify }}</p>
          {{- end -}}
        </div>
      {{- end -}}

      {{- /* Intro Text (Optional) */ -}}
      {{- if $intro -}}
        <div class="c-confidentiality-notice__intro">
          {{- /* Support both string and array of strings */ -}}
          {{- if reflect.IsSlice $intro -}}
            {{- range $intro -}}
              <p>{{ . | markdownify }}</p>
            {{- end -}}
          {{- else -}}
            <p>{{ $intro | markdownify }}</p>
          {{- end -}}
        </div>
      {{- end -}}

      {{- /* Notices Grid (Optional) */ -}}
      {{- if $notices -}}
        <div class="c-confidentiality-notice__notices">
          {{- range $index, $notice := $notices -}}
            {{- /* Validate notice data */ -}}
            {{- if not $notice.type -}}
              {{- warnf "confidentiality-notice: Notice %d missing 'type' (page: %s)" $index $.Page.File.Path -}}
            {{- end -}}
            {{- if not $notice.content -}}
              {{- warnf "confidentiality-notice: Notice %d missing 'content' (page: %s)" $index $.Page.File.Path -}}
            {{- end -}}

            {{ partial "molecules/info-box.html" (dict
              "type" ($notice.type | default "tip")
              "title" $notice.title
              "content" $notice.content
            ) }}
          {{- end -}}
        </div>
      {{- end -}}

      {{- /* Confidentiality Limits (Optional) */ -}}
      {{- if $limits -}}
        {{- if $limits.items -}}
          <div class="c-confidentiality-notice__limits">
            {{- /* Limits Title */ -}}
            <div class="c-confidentiality-notice__limits-title">
              {{- /* Warning Icon */ -}}
              {{ partial "atoms/icon.html" (dict
                "name" "exclamation-triangle"
                "size" "md"
                "variant" "warning"
              ) }}
              <span>{{ $limits.title | default (i18n "confidentiality_exceptions" | default "Exceptions to Confidentiality") }}</span>
            </div>

            {{- /* Limits List */ -}}
            <ul class="c-confidentiality-notice__limits-list">
              {{- range $limits.items -}}
                <li>{{ . | markdownify }}</li>
              {{- end -}}
            </ul>
          </div>
        {{- else -}}
          {{- warnf "confidentiality-notice: 'limits.items' array is required when limits present (page: %s)" $.Page.File.Path -}}
        {{- end -}}
      {{- end -}}

      {{- /* Optional Link to Full Policy */ -}}
      {{- if $link -}}
        {{- if and $link.text $link.url -}}
          <div class="c-confidentiality-notice__link">
            {{ partial "atoms/link.html" (dict
              "text" $link.text
              "url" $link.url
              "icon" "arrow-right"
              "iconPosition" "right"
            ) }}
          </div>
        {{- else -}}
          {{- warnf "confidentiality-notice: Link requires both 'text' and 'url' (page: %s)" $.Page.File.Path -}}
        {{- end -}}
      {{- end -}}

    </div>
  </section>

{{- end -}}
