{{/*
  Testimonials Enhanced Section - White Cards with Design Excellence Features

  Usage:
    sections:
      - type: "testimonials-enhanced"

    testimonials_enhanced:
      title: "What Clients Say"
      subtitle: "Real stories from our community"
      testimonials:
        - quote: "Therapy helped me understand my patterns..."
          name: "Maria S."
          role: "Individual Therapy Client"
          featured: true
        - quote: "I learned tools to manage anxiety..."
          name: "Alexandru P."
          role: "CBT Program Participant"

  BEM Structure:
    .c-testimonials                    Block
    .c-testimonials__header            Element: section header
    .c-testimonials__grid              Element: testimonials grid
    .c-testimonials__item              Element: single testimonial card
    .c-testimonials__item--primary     Modifier: primary border color
    .c-testimonials__avatar            Element: avatar circle
    .c-testimonials__quote             Element: quote text
    .c-testimonials__author            Element: author info

  Version: 4.0.0 (Design Excellence)
  Last Updated: 2025-11-26
*/}}

{{- /* Parameter extraction - support both data keys */ -}}
{{- $section := .Params.testimonials_enhanced -}}
{{- if not $section -}}
  {{- $section = .Params.testimonials_section -}}
{{- end -}}
{{- if not $section -}}
  {{- return -}}
{{- end -}}

{{- $title := $section.title | default "" -}}
{{- $subtitle := $section.subtitle | default "" -}}
{{- $testimonials := $section.testimonials | default slice -}}

{{- if not $testimonials -}}
  {{- return -}}
{{- end -}}

{{- /* Color variants for border rotation */ -}}
{{- $borderColors := slice "primary" "secondary" "coral" -}}

<section class="c-testimonials">
  <div class="o-container">

    {{- /* Section Header */ -}}
    {{- if or $title $subtitle -}}
    <div class="c-testimonials__header">
      {{- if $subtitle -}}
        <p class="c-testimonials__subtitle">{{ $subtitle }}</p>
      {{- end -}}
      {{- if $title -}}
        {{ partial "atoms/heading.html" (dict
          "text" $title
          "level" 2
          "class" "c-testimonials__title"
        ) }}
      {{- end -}}
    </div>
    {{- end -}}

    {{- /* Testimonials Grid */ -}}
    {{- /* Design Excellence 3.2: nth-child(even) gets 24px offset via CSS */ -}}
    <div class="c-testimonials__grid">
      {{- range $index, $testimonial := $testimonials -}}
        {{- /* Rotate border colors: primary → secondary → coral */ -}}
        {{- $colorIndex := mod $index 3 -}}
        {{- $borderColor := index $borderColors $colorIndex -}}

        <div class="c-testimonials__item c-testimonials__item--{{ $borderColor }}">
          {{- /* Floating Quote Mark */ -}}
          <span class="c-testimonials__floating-quote">"</span>

          {{- /* Avatar Circle with Initials */ -}}
          {{- if $testimonial.name -}}
            {{- $initials := substr $testimonial.name 0 2 -}}
            <div class="c-testimonials__avatar c-testimonials__avatar--{{ $borderColor }}">
              <span>{{ upper $initials }}</span>
            </div>
          {{- end -}}

          {{- /* Quote Text */ -}}
          {{- if $testimonial.quote -}}
            <blockquote class="c-testimonials__quote">
              {{ $testimonial.quote }}
            </blockquote>
          {{- end -}}

          {{- /* Author Info */ -}}
          <div class="c-testimonials__author">
            {{- if $testimonial.name -}}
              <p class="c-testimonials__name">{{ $testimonial.name }}</p>
            {{- end -}}
            {{- if $testimonial.role -}}
              <p class="c-testimonials__role">{{ $testimonial.role }}</p>
            {{- end -}}
            {{- if $testimonial.outcome -}}
              <p class="c-testimonials__outcome">{{ $testimonial.outcome }}</p>
            {{- end -}}
          </div>

          {{- /* Verified Badge */ -}}
          {{- if $testimonial.verified -}}
            <span class="c-testimonials__verified">
              <i class="las la-check-circle"></i> Verificat
            </span>
          {{- end -}}
        </div>
      {{- end -}}
    </div>

  </div>
</section>
