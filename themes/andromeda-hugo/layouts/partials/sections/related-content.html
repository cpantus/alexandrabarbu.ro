{{/* Related Content Section - Automatic related pages using Hugo's algorithm */}}
{{ $section := .Params.related_content }}
{{ $relatedPages := .Site.RegularPages.Related . | first 3 }}

{{/* Show section if explicitly enabled OR if there are related pages */}}
{{ if or (and $section $section.enable) (gt (len $relatedPages) 0) }}
  <section class="section related-content bg-light">
    <div class="container-xxl position-relative">
      <div class="row">
        <div class="col-lg-12">
          <div class="section-title text-center mb-5">
            {{ if and $section $section.title }}
              <h3 class="title">{{ $section.title | markdownify }}</h3>
            {{ else }}
              <h3 class="title">{{ i18n "related_content" | default "Con»õinut Legat" }}</h3>
            {{ end }}
            {{ if and $section $section.description }}
              <p>{{ $section.description | markdownify }}</p>
            {{ else }}
              <p>{{ i18n "related_content_description" | default "Alte resurse care te-ar putea interesa" }}</p>
            {{ end }}
          </div>

          <div class="row justify-content-center">
            {{ range $relatedPages }}
              <div class="col-lg-4 col-md-6 mb-4">
                {{/* Use blog-card molecule for consistent card design */}}
                {{ partial "molecules/blog-card.html" (dict
                  "title" .Title
                  "link" .RelPermalink
                  "description" (or .Description .Summary)
                  "image" (or .Params.image .Params.hero_image "")
                  "date" .Date
                  "readTime" .ReadingTime
                  "category" (or (index .Params.service_types 0) (index .Params.therapies 0) "")
                  "type" "related"
                ) }}
              </div>
            {{ end }}
          </div>

          {{/* Optional: Show taxonomies for current page */}}
          {{ if and $section $section.show_taxonomies }}
            <div class="row mt-4">
              <div class="col-lg-12 text-center">
                <div class="taxonomies">
                  {{ with .Params.therapies }}
                    <div class="taxonomy-group mb-2">
                      <span class="taxonomy-label">{{ i18n "therapies" | default "Terapii" }}:</span>
                      {{ range . }}
                        <a href="{{ "/therapies/" | relLangURL }}{{ . | urlize }}" class="badge bg-primary text-white me-1">{{ . }}</a>
                      {{ end }}
                    </div>
                  {{ end }}

                  {{ with .Params.conditions }}
                    <div class="taxonomy-group mb-2">
                      <span class="taxonomy-label">{{ i18n "conditions" | default "Probleme" }}:</span>
                      {{ range . }}
                        <a href="{{ "/conditions/" | relLangURL }}{{ . | urlize }}" class="badge bg-secondary text-white me-1">{{ . }}</a>
                      {{ end }}
                    </div>
                  {{ end }}
                </div>
              </div>
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  </section>
{{ end }}
