{{/*
  ============================================================================
  Stats Numbers Section - BEM Refactored
  ============================================================================
  Enhanced v4.0 section with SVG progress rings, animated counting, glassmorphism

  Features:
  - SVG circular progress rings with gradient strokes
  - Animated counting from 0 to target value (2s duration via stats-counter.js)
  - Glassmorphism cards with gradient glow on hover
  - 4 color variants (emerald, terracotta, teal, amber) cycle automatically
  - Staggered entrance animations (fade-in-up)
  - Responsive ring sizing (120px → 100px → 90px)
  - Optional icon mode (without ring)
  - Pulse effect during counting animation

  Data Structure:
  ---------------
  stats_numbers:
    enable: true                        # Required - Show/hide section
    title: "Our Impact"                 # Optional - Section title
    subtitle: "By The Numbers"          # Optional - Eyebrow text
    stats:
      - value: 500                      # Required - Numeric value
        suffix: "+"                     # Optional - Suffix (%, +, k, etc.)
        label: "Clients Helped"         # Required - Description label
        icon: "users"                   # Optional - Icon (uses icon instead of ring)
        progress: 75                    # Optional - Ring progress % (0-100)

  Parameters:
  -----------
  None - Data-driven from front matter or shared data

  Usage:
  ------
  ```yaml
  sections:
    - type: "stats-numbers"

  stats_numbers:
    enable: true
    title: "Our Impact in Numbers"
    subtitle: "Proven Results"
    stats:
      - value: 500
        suffix: "+"
        label: "Clients Helped"
        progress: 85
      - value: 15
        suffix: "+"
        label: "Years Experience"
        progress: 100
      - value: 95
        suffix: "%"
        label: "Success Rate"
        progress: 95
      - value: 1200
        suffix: "+"
        label: "Sessions Completed"
        progress: 90
  ```

  BEM Structure:
  --------------
  .c-stats                   - Section wrapper
  .c-stats__container        - Inner container
  .c-stats__header           - Title/subtitle wrapper
  .c-stats__subtitle         - Eyebrow text
  .c-stats__title            - Section heading
  .c-stats__grid             - Stats grid layout
  .c-stats__item             - Individual stat card
    .c-stats__item--variant-{1-4} - Color variants (auto-cycled)
  .c-stats__ring             - SVG ring container
  .c-stats__ring-svg         - SVG element
  .c-stats__ring-bg          - Background circle
  .c-stats__ring-progress    - Animated progress circle
  .c-stats__inner            - Number + label inside ring
  .c-stats__number           - Number wrapper
  .c-stats__count            - Animated count value
  .c-stats__suffix           - Suffix text
  .c-stats__label            - Description label
  .c-stats__icon             - Icon (alternative to ring)

  Dependencies:
  -------------
  - atoms/heading.html (section title)
  - atoms/icon.html (optional icon mode)
  - _stats.scss (439 lines BEM styles)
  - stats-counter.js (animated counting)

  Version: 5.0.1 (BEM refactor)
  Updated: 2025-11-20
  ============================================================================
*/}}

{{- $section := .Params.stats_numbers -}}
{{- if not $section -}}
  {{- with .Site.Data.shared_sections -}}
    {{- $section = .stats_numbers -}}
  {{- end -}}
{{- end -}}

{{- with $section -}}
  {{- if .enable -}}
    <section class="c-stats">
      {{/* SVG Gradient Definitions (hidden, referenced by progress rings) */}}
      <svg class="c-stats__svg-defs" aria-hidden="true">
        <defs>
          {{/* Emerald gradient */}}
          <linearGradient id="gradient-emerald" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#4DB380;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#6FD89D;stop-opacity:1" />
          </linearGradient>

          {{/* Terracotta gradient */}}
          <linearGradient id="gradient-terracotta" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#CC6B49;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#E08968;stop-opacity:1" />
          </linearGradient>

          {{/* Teal gradient */}}
          <linearGradient id="gradient-teal" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#14B8A6;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#2DD4BF;stop-opacity:1" />
          </linearGradient>

          {{/* Amber gradient */}}
          <linearGradient id="gradient-amber" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#FBBF24;stop-opacity:1" />
          </linearGradient>
        </defs>
      </svg>

      <div class="o-container c-stats__container">
        {{/* Section Header (optional) */}}
        {{- if or .title .subtitle -}}
          <div class="c-stats__header">
            {{- if .subtitle -}}
              <p class="c-stats__subtitle">{{ .subtitle | markdownify }}</p>
            {{- end -}}

            {{- if .title -}}
              {{- partial "atoms/heading.html" (dict
                "text" (.title | markdownify)
                "level" "h2"
                "variant" "primary"
                "class" "c-stats__title"
              ) -}}
            {{- end -}}
          </div>
        {{- end -}}

        {{/* Stats Grid */}}
        <div class="c-stats__grid">
          {{- range $index, $stat := .stats -}}
            {{- $variant := add (mod $index 4) 1 -}}{{/* Cycle through variants 1-4 */}}
            {{- $progress := default 100 $stat.progress -}}{{/* Default to 100% if not specified */}}
            {{- $radius := 45 -}}{{/* Ring radius (120px diameter / 2 - stroke width) */}}
            {{- $circumference := mul (mul 2 3.14159) $radius -}}{{/* 2πr ≈ 283 */}}
            {{- $dashoffset := sub $circumference (mul $circumference (div (float $progress) 100.0)) -}}

            <div class="c-stats__item c-stats__item--variant-{{ $variant }}">
              {{- if $stat.icon -}}
                {{/* Icon Mode (without ring) */}}
                <div class="c-stats__icon">
                  {{- partial "atoms/icon.html" (dict
                    "name" $stat.icon
                    "size" "lg"
                    "variant" "white"
                  ) -}}
                </div>
              {{- else -}}
                {{/* SVG Progress Ring Mode */}}
                <div class="c-stats__ring">
                  <svg class="c-stats__ring-svg" viewBox="0 0 100 100">
                    {{/* Background circle (gray track) */}}
                    <circle class="c-stats__ring-bg"
                            cx="50"
                            cy="50"
                            r="{{ $radius }}"
                            fill="none"
                            stroke-width="8"></circle>

                    {{/* Progress circle (gradient stroke, animated) */}}
                    <circle class="c-stats__ring-progress"
                            cx="50"
                            cy="50"
                            r="{{ $radius }}"
                            fill="none"
                            stroke-width="8"
                            stroke-dasharray="{{ $circumference }}"
                            stroke-dashoffset="{{ $dashoffset }}"></circle>
                  </svg>

                  {{/* Inner Content (number + label inside ring) */}}
                  <div class="c-stats__inner">
                    <div class="c-stats__number">
                      <span class="c-stats__count" data-count="{{ $stat.value }}">0</span>{{- if $stat.suffix -}}<span class="c-stats__suffix">{{ $stat.suffix }}</span>{{- end -}}
                    </div>
                  </div>
                </div>
              {{- end -}}

              {{/* Label (below ring or icon) */}}
              {{- if $stat.label -}}
                <div class="c-stats__label">{{ $stat.label | markdownify }}</div>
              {{- end -}}
            </div>
          {{- end -}}
        </div>
      </div>
    </section>
  {{- end -}}
{{- end -}}
