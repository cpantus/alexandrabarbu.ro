{{/* Problem/Empathy Section - Enhanced v4.0 with glassmorphism & gradient icons */}}
{{ $section := .Params.problem_empathy }}

{{ with $section }}
  {{ if .enable }}
    <section class="problem-empathy">
      <div class="container">
        {{/* Section Header - Uses atoms/heading.html for consistent typography */}}
        <div class="problem-empathy-header">
          {{ if .subtitle }}
            <p class="subtitle">{{ .subtitle | markdownify }}</p>
          {{ end }}
          {{ if .title }}
            {{ partial "atoms/heading.html" (dict "text" (.title | markdownify) "level" "h2" "class" "title") }}
          {{ end }}
          {{ if .description }}
            <p class="description">{{ .description | markdownify }}</p>
          {{ end }}
        </div>

        {{/* Problem Cards Grid */}}
        <div class="problem-grid">
          {{ range $index, $challenge := .challenges }}
            {{/* v4.0 color rotation: 4-color pattern (primary→secondary→coral→sage) */}}
            {{ $colorVariants := slice "primary" "secondary" "coral" "sage" }}
            {{ $colorIdx := mod $index (len $colorVariants) }}
            {{ $colorVariant := index $colorVariants $colorIdx }}

            <div class="problem-card" data-aos="fade-up" data-aos-delay="{{ mul $index 100 }}">
              {{/* Icon with gradient circle wrapper - v4.0 design system */}}
              {{ partial "atoms/icon.html" (dict
                "name" ($challenge.icon | default "exclamation-circle")
                "withWrapper" true
                "wrapperVariant" $colorVariant
                "wrapperSize" "lg"
                "class" "problem-icon"
              ) }}

              {{/* Card Content - Uses atoms/heading.html for consistent typography */}}
              <div class="problem-content">
                {{ partial "atoms/heading.html" (dict
                  "text" $challenge.title
                  "level" "h3"
                  "class" "problem-title"
                  "colorVariant" $colorVariant
                ) }}
                <p class="problem-description">{{ $challenge.description }}</p>
              </div>
            </div>
          {{ end }}
        </div>

        {{/* Optional Empathy Message */}}
        {{ if .empathy_text }}
          <div class="empathy-message text-center mt-5">
            <p class="lead">{{ .empathy_text | markdownify }}</p>
          </div>
        {{ end }}
      </div>
    </section>
  {{ end }}
{{ end }}
