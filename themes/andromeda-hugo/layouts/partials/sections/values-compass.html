{{/*
  Values Compass Section - Compass-pattern layout for core values/principles

  Usage:
    Add to page front matter:
    ---
    sections:
      - type: "values-compass"

    values_compass:
      enable: true
      title: "Core Values"
      subtitle: "What Guides Us" (optional)
      description: "Our foundational principles" (optional)
      variant: "primary|secondary|tertiary|neutral" (default: primary)
      benefits:
        - title: "Evidence-Based"
          icon: "las la-flask"
          description: "Scientific methods"
          variant: "primary" (optional, overrides section variant)
        - title: "Compassionate"
          icon: "las la-heart"
          description: "Empathetic care"
          variant: "secondary" (optional)
      cta:
        text: "Learn More"
        url: "/approach/"
      button_variant: "primary" (optional)
    ---

  Features:
    - BEM structure (.c-values-compass)
    - Compass visual connectors (SVG)
    - Uses value-card molecule for each item
    - Auto color variant cycling (primary → secondary → tertiary → neutral)
    - Optional CTA button
    - Mobile touch interactions (JS)
    - Responsive grid (1-col mobile, 2-col tablet, 3-4-col desktop)
    - Accessibility (ARIA, keyboard nav, reduced motion)

  Dependencies:
    - Molecules: value-card.html
    - Atoms: button.html, heading.html
    - SCSS: _values-compass.scss
    - JS: values-compass-interactions.js
*/}}

{{- $section := .Params.values_compass -}}

{{/* Fallback to old benefits_section param for backwards compatibility */}}
{{- if not $section -}}
  {{- $section = .Params.benefits_section -}}
{{- end -}}

{{- with $section -}}
  {{- if .enable -}}
    {{- $variant := .variant | default "primary" -}}
    {{- $subtitle := .subtitle -}}
    {{- $title := .title -}}
    {{- $description := .description -}}
    {{- $benefits := .benefits -}}
    {{- $cta := .cta -}}
    {{- $buttonVariant := .button_variant | default "primary" -}}

    <section class="c-values-compass c-values-compass--{{ $variant }}" id="values">
      <div class="c-values-compass__container o-container">
        {{/* Section Header */}}
        <div class="c-values-compass__header">
          {{- if $subtitle -}}
            <p class="c-values-compass__subtitle">{{ $subtitle | markdownify }}</p>
          {{- end -}}

          {{ partial "atoms/heading.html" (dict
            "text" ($title | markdownify)
            "level" "h2"
            "class" "c-values-compass__title"
            "variant" $variant
          ) }}

          {{- if $description -}}
            <p class="c-values-compass__description">{{ $description | markdownify }}</p>
          {{- end -}}
        </div>

        {{/* Compass Visual Container */}}
        <div class="c-values-compass__compass">
          {{/* SVG Connector Lines */}}
          <div class="c-values-compass__connectors" aria-hidden="true">
            <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" class="c-values-compass__svg">
              {{/* Center point */}}
              <circle cx="400" cy="200" r="8" class="c-values-compass__center" />

              {{/* Connector lines from center to cards */}}
              <path d="M 400 200 L 200 400" class="c-values-compass__line" />
              <path d="M 400 200 L 400 400" class="c-values-compass__line" />
              <path d="M 400 200 L 600 400" class="c-values-compass__line" />

              {{/* Arc connecting bottom cards */}}
              <path d="M 200 400 Q 400 450 600 400" class="c-values-compass__arc" />
            </svg>
          </div>

          {{/* Value Cards Grid */}}
          <div class="c-values-compass__grid">
            {{- range $index, $item := $benefits -}}
              {{- $itemVariant := $item.variant -}}

              {{/* Auto-cycle variants if not specified */}}
              {{- if not $itemVariant -}}
                {{- $variants := slice "primary" "secondary" "tertiary" "neutral" -}}
                {{- $itemVariant = index $variants (mod $index 4) -}}
              {{- end -}}

              {{/* Render value card molecule */}}
              {{ partial "molecules/value-card.html" (dict
                "title" $item.title
                "icon" $item.icon
                "description" $item.description
                "variant" $itemVariant
                "icon_style" "wrapper"
              ) }}
            {{- end -}}
          </div>
        </div>

        {{/* Optional CTA */}}
        {{- if $cta -}}
          <div class="c-values-compass__cta">
            {{ partial "atoms/button.html" (dict
              "text" $cta.text
              "url" $cta.url
              "variant" $buttonVariant
              "size" "lg"
            ) }}
          </div>
        {{- end -}}
      </div>

      {{/* Mobile interaction JavaScript */}}
      {{- $js := resources.Get "js/values-compass-interactions.js" -}}
      {{- if $js -}}
        {{- if hugo.IsProduction -}}
          {{- $js = $js | minify | fingerprint -}}
        {{- end -}}
        <script src="{{ $js.RelPermalink }}" {{ if hugo.IsProduction }}integrity="{{ $js.Data.Integrity }}"{{ end }} defer></script>
      {{- end -}}
    </section>
  {{- end -}}
{{- end -}}
