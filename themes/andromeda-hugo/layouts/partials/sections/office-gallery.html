{{/* Office Gallery Section - Display therapy office photos with lightbox */}}
{{- $section := .Params.office_gallery -}}

{{- with $section -}}
  {{- if .enable -}}
    <section class="section office-gallery {{ if .background }}bg-{{ .background }}{{ else }}bg-white{{ end }}">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            {{- if or .subtitle .title .description -}}
              <div class="section-title text-center mb-5" data-aos="fade-up">
                {{- if .subtitle -}}
                  <p class="subtitle text-muted">{{ .subtitle | markdownify }}</p>
                {{- end -}}
                {{- if .title -}}
                  {{ partial "atoms/heading.html" (dict
                    "text" .title
                    "level" 2
                    "class" "title mb-3"
                  ) }}
                {{- end -}}
                {{- if .description -}}
                  <p class="lead text-muted">{{ .description | markdownify }}</p>
                {{- end -}}
              </div>
            {{- end -}}

            <div class="gallery-grid row g-4">
              {{- range $index, $photo := .photos -}}
                <div class="col-12 col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ mul $index 100 }}">
                  <div class="gallery-item">
                    <div class="gallery-image-wrapper position-relative overflow-hidden rounded-3">
                      {{- if .image -}}
                        {{- $imagePath := printf "images/office/%s" .image -}}
                        {{ partial "atoms/image.html" (dict
                          "src" $imagePath
                          "alt" (printf "Office photo: %s" .caption)
                          "class" "gallery-image img-fluid w-100"
                          "loading" "lazy"
                        ) }}
                      {{- end -}}

                      <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                        <button class="gallery-zoom-btn btn btn-light rounded-circle"
                                aria-label="{{ printf "View %s photo in full size" .caption }}"
                                data-bs-toggle="modal"
                                data-bs-target="#galleryModal{{ $index }}">
                          {{ partial "atoms/icon.html" (dict "name" "search-plus" "class" "text-primary") }}
                        </button>
                      </div>
                    </div>

                    {{- if or .caption .description -}}
                      <div class="gallery-caption mt-3">
                        {{- if .caption -}}
                          <h4 class="caption-title h6 mb-2 fw-semibold">{{ .caption }}</h4>
                        {{- end -}}
                        {{- if .description -}}
                          <p class="caption-text small text-muted mb-0">{{ .description | markdownify }}</p>
                        {{- end -}}
                      </div>
                    {{- end -}}
                  </div>
                </div>

                {{/* Modal for full-size image */}}
                <div class="modal fade" id="galleryModal{{ $index }}" tabindex="-1" aria-labelledby="galleryModalLabel{{ $index }}" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content bg-transparent border-0">
                      <div class="modal-header border-0">
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body p-0">
                        {{- if .image -}}
                          {{- $imagePath := printf "images/office/%s" .image -}}
                          {{ partial "atoms/image.html" (dict
                            "src" $imagePath
                            "alt" (printf "Office photo: %s" .caption)
                            "class" "img-fluid w-100 rounded-3"
                          ) }}
                        {{- end -}}
                        {{- if .caption -}}
                          <p class="text-white text-center mt-3 mb-0">{{ .caption }}</p>
                        {{- end -}}
                      </div>
                    </div>
                  </div>
                </div>
              {{- end -}}
            </div>

            {{- if .cta_text -}}
              <div class="gallery-cta text-center mt-5" data-aos="fade-up">
                <p class="text-muted mb-3">{{ .cta_text | markdownify }}</p>
                {{- if .cta_button -}}
                  {{ partial "atoms/button.html" (dict
                    "text" .cta_button.text
                    "url" .cta_button.url
                    "variant" (.cta_button.variant | default "primary")
                    "icon" .cta_button.icon
                  ) }}
                {{- end -}}
              </div>
            {{- end -}}
          </div>
        </div>
      </div>
    </section>
  {{- end -}}
{{- end -}}
