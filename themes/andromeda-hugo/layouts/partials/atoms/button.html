{{/*
  Button Atom - Reusable button component

  Usage:
    {{ partial "atoms/button.html" (dict
      "text" "Click Me"
      "href" "/link"
      "variant" "primary"
      "size" "md"
      "type" "link"
      "class" "mt-4"
      "fullWidth" false
      "icon" "las la-arrow-right"
      "iconPosition" "right"
    )}}

  Parameters:
    text (required) - Button text/label
    href (optional) - Link URL (for link buttons)
    variant (optional) - primary|secondary|tertiary|success|warning|error|info|neutral|outline-primary|outline-secondary (default: primary)
    size (optional) - sm|md|lg (default: md)
    type (optional) - link|button|submit (default: link if href exists, else button)
    class (optional) - Additional CSS classes
    fullWidth (optional) - true|false (default: false)
    icon (optional) - Icon class (e.g., "las la-arrow-right")
    iconPosition (optional) - left|right (default: right)
    attributes (optional) - Additional HTML attributes as dict
    animate (optional) - Animation type (e.g., "magnetic-button", "ripple")
    animateOptions (optional) - Animation options as dict (e.g., (dict "strength" "0.3"))
    loading (optional) - true|false (default: false) - Shows spinner and disables button
*/}}

{{ $text := .text }}
{{ $href := .href }}
{{ $variant := .variant | default "primary" }}
{{ $size := .size | default "md" }}
{{ $type := .type | default (cond (isset . "href") "link" "button") }}
{{ $class := .class | default "" }}
{{ $fullWidth := .fullWidth | default false }}
{{ $icon := .icon }}
{{ $iconPosition := .iconPosition | default "right" }}
{{ $attributes := .attributes | default dict }}
{{ $animate := .animate }}
{{ $animateOptions := .animateOptions | default dict }}
{{ $loading := .loading | default false }}

{{/* Build button classes (BEM naming) */}}
{{ $btnClass := printf "c-button c-button--%s" $variant }}
{{ if eq $size "sm" }}
  {{ $btnClass = printf "%s c-button--sm" $btnClass }}
{{ else if eq $size "lg" }}
  {{ $btnClass = printf "%s c-button--lg" $btnClass }}
{{ end }}
{{ if $fullWidth }}
  {{ $btnClass = printf "%s w-100" $btnClass }}
{{ end }}
{{ if $loading }}
  {{ $btnClass = printf "%s c-button--loading" $btnClass }}
{{ end }}
{{ if $class }}
  {{ $btnClass = printf "%s %s" $btnClass $class }}
{{ end }}

{{/* Render button content with optional icon */}}
{{ define "button-content" }}
  {{ if .loading }}
    <span class="c-button__spinner">
      <i class="las la-circle-notch la-spin me-2"></i>
    </span>
  {{ end }}
  {{ if and .icon (eq .iconPosition "left") (not .loading) }}
    <i class="{{ .icon }} me-2" data-icon-animate="slide-right"></i>
  {{ end }}
  <span class="c-button__text">{{ .text }}</span>
  {{ if and .icon (eq .iconPosition "right") (not .loading) }}
    <i class="{{ .icon }} ms-2" data-icon-animate="slide-right"></i>
  {{ end }}
{{ end }}

{{/* Render as link or button */}}
{{ if eq $type "link" }}
  <a href="{{ $href | relURL }}" class="{{ $btnClass }}"
    {{- if $loading }} aria-disabled="true" tabindex="-1"{{ end -}}
    {{- if $animate }} data-animate="{{ $animate }}"{{ end -}}
    {{- range $key, $value := $animateOptions }} data-{{ $key }}="{{ $value }}"{{ end -}}
    {{- range $key, $value := $attributes }} {{ $key }}="{{ $value }}"{{ end -}}>
    {{- template "button-content" (dict "icon" $icon "iconPosition" $iconPosition "text" $text "loading" $loading) -}}
  </a>
{{ else }}
  <button
    {{- if eq $type "submit" }} type="submit"
    {{- else }} type="button"{{ end }}
    class="{{ $btnClass }}"
    {{- if $loading }} disabled aria-busy="true"{{ end -}}
    {{- if $animate }} data-animate="{{ $animate }}"{{ end -}}
    {{- range $key, $value := $animateOptions }} data-{{ $key }}="{{ $value }}"{{ end -}}
    {{- range $key, $value := $attributes }} {{ $key }}="{{ $value }}"{{ end -}}>
    {{- template "button-content" (dict "icon" $icon "iconPosition" $iconPosition "text" $text "loading" $loading) -}}
  </button>
{{ end }}
