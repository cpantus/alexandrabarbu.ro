{{/*
  Icon Atom - Icon component with BEM naming (Phase 2 Refactored)

  Usage:
    {{ partial "atoms/icon.html" (dict
      "name" "check-circle"
      "size" "md"
      "variant" "primary"
      "class" "me-2"
    )}}

    With gradient circle wrapper (BEM):
    {{ partial "atoms/icon.html" (dict
      "name" "check-circle"
      "withWrapper" true
      "variant" "primary"
      "size" "md"
    )}}

    Flat icon (no wrapper):
    {{ partial "atoms/icon.html" (dict
      "name" "heart"
      "flat" true
      "variant" "secondary"
    )}}

  Parameters:
    name (required) - Icon name (without "la-" prefix, e.g., "check-circle", "arrow-right")
    size (optional) - Wrapper size: sm|md|lg|xl (default: "md") - only for withWrapper=true
    variant (optional) - Color variant: primary|secondary|tertiary|success|warning|error|info|neutral (default: "primary")
    class (optional) - Additional CSS classes
    prefix (optional) - Icon library prefix (default: "las" for Line Awesome Solid)
    ariaLabel (optional) - Accessibility label for screen readers
    ariaHidden (optional) - Hide from screen readers (default: false)
    attributes (optional) - Additional HTML attributes as dict

    withWrapper (optional) - Wrap icon with gradient circle background (default: false)
    flat (optional) - Flat icon with color, no background (default: false)
    glass (optional) - Glassmorphism style (requires withWrapper=true) (default: false)

    animation (optional) - Animation modifier: pulse|rotate|float (default: none)
    responsive (optional) - Auto-scale based on viewport (default: false)

  Unified Color Variants (Phase 2):
    - primary: Emerald green (main actions, trust, professional)
    - secondary: Terracotta (warm actions, personal connection)
    - tertiary: Navy blue (informational, support)
    - success: Sage green (positive feedback, achievements)
    - warning: Amber (caution, important notices)
    - error: Red (errors, critical alerts)
    - info: Teal (informational content)
    - neutral: Gray (subtle, backgrounds)

  Icon Libraries:
    - las: Line Awesome Solid (default)
    - lar: Line Awesome Regular
    - lab: Line Awesome Brands
    - la: Line Awesome base

  Wrapper Sizes (BEM modifiers):
    - sm: 32px circle (icon: 16px)
    - md: 48px circle (icon: 24px) (default)
    - lg: 64px circle (icon: 32px)
    - xl: 84px circle (icon: 42px)

  Examples:
    Check icon: {{ partial "atoms/icon.html" (dict "name" "check-circle" "variant" "success") }}
    Large shield: {{ partial "atoms/icon.html" (dict "name" "shield-alt" "size" "xl" "variant" "primary" "withWrapper" true) }}
    Arrow right: {{ partial "atoms/icon.html" (dict "name" "arrow-right" "class" "ms-2") }}
    Gradient circle: {{ partial "atoms/icon.html" (dict "name" "heart" "withWrapper" true "variant" "secondary" "size" "lg") }}
    Flat icon: {{ partial "atoms/icon.html" (dict "name" "star" "flat" true "variant" "primary") }}
    Pulse animation: {{ partial "atoms/icon.html" (dict "name" "bell" "withWrapper" true "animation" "pulse") }}
*/}}

{{/* Parse parameters */}}
{{ $name := .name }}
{{ $size := .size | default "md" }}
{{ $variant := .variant | default "primary" }}
{{ $class := .class | default "" }}
{{ $prefix := .prefix | default "las" }}
{{ $ariaLabel := .ariaLabel }}
{{ $ariaHidden := .ariaHidden | default false }}
{{ $attributes := .attributes | default dict }}

{{/* Wrapper and style parameters */}}
{{ $withWrapper := .withWrapper | default false }}
{{ $flat := .flat | default false }}
{{ $glass := .glass | default false }}
{{ $animation := .animation | default "" }}
{{ $responsive := .responsive | default false }}

{{/* Legacy parameters (backward compatibility) */}}
{{ $color := .color }}  {{/* Old color parameter for backward compat */}}
{{ $wrapperVariant := .wrapperVariant }}  {{/* Old wrapperVariant for backward compat */}}
{{ $wrapperSize := .wrapperSize }}  {{/* Old wrapperSize for backward compat */}}
{{ $wrapperClass := .wrapperClass | default "" }}

{{/* Map legacy parameters to new unified parameters */}}
{{ if $color }}
  {{ $variant = $color }}
{{ end }}
{{ if $wrapperVariant }}
  {{ $variant = $wrapperVariant }}
{{ end }}
{{ if $wrapperSize }}
  {{ $size = $wrapperSize }}
{{ end }}

{{/* Validate required parameter - skip rendering if no name */}}
{{ if not $name }}
  {{/* Silently skip rendering if no icon name is provided */}}
  {{ return }}
{{ end }}

{{/* Build icon base classes (Line Awesome) */}}
{{ $iconClass := printf "%s la-%s" $prefix $name }}

{{/* Add custom classes to icon */}}
{{ if $class }}
  {{ $iconClass = printf "%s %s" $iconClass $class }}
{{ end }}

{{/* Render icon with BEM wrapper or bare */}}
{{- if $withWrapper -}}
  {{/* Build BEM wrapper classes - format: c-icon c-icon--{size} c-icon--{variant} */}}
  {{ $wrapperClasses := "c-icon" }}

  {{/* Add size modifier (only if not default 'md') */}}
  {{ if ne $size "md" }}
    {{ $wrapperClasses = printf "%s c-icon--%s" $wrapperClasses $size }}
  {{ end }}

  {{/* Add variant modifier (only if not default 'primary') */}}
  {{ if ne $variant "primary" }}
    {{ $wrapperClasses = printf "%s c-icon--%s" $wrapperClasses $variant }}
  {{ end }}

  {{/* Add glassmorphism modifier */}}
  {{ if $glass }}
    {{ $wrapperClasses = printf "%s c-icon--glass" $wrapperClasses }}
  {{ end }}

  {{/* Add animation modifier */}}
  {{ if $animation }}
    {{ $wrapperClasses = printf "%s c-icon--%s" $wrapperClasses $animation }}
  {{ end }}

  {{/* Add responsive modifier */}}
  {{ if $responsive }}
    {{ $wrapperClasses = printf "%s c-icon--responsive" $wrapperClasses }}
  {{ end }}

  {{/* Add legacy wrapper class for backward compatibility */}}
  {{ if $wrapperClass }}
    {{ $wrapperClasses = printf "%s %s" $wrapperClasses $wrapperClass }}
  {{ end }}

  {{/* Render wrapped icon (BEM) */}}
  <div class="{{ $wrapperClasses }}">
    <i class="{{ $iconClass }}"
      {{- if $ariaLabel }} aria-label="{{ $ariaLabel }}"{{ end }}
      {{- if $ariaHidden }} aria-hidden="true"{{ end }}
      {{- range $key, $value := $attributes }} {{ $key }}="{{ $value }}"{{ end -}}></i>
  </div>

{{- else if $flat -}}
  {{/* Build BEM flat icon classes - format: c-icon c-icon--flat c-icon--{variant} */}}
  {{ $flatClasses := "c-icon c-icon--flat" }}

  {{/* Add variant modifier */}}
  {{ if ne $variant "primary" }}
    {{ $flatClasses = printf "%s c-icon--%s" $flatClasses $variant }}
  {{ end }}

  {{/* Add custom classes */}}
  {{ if $class }}
    {{ $flatClasses = printf "%s %s" $flatClasses $class }}
  {{ end }}

  {{/* Render flat icon wrapper (BEM) */}}
  <div class="{{ $flatClasses }}">
    <i class="{{ $iconClass }}"
      {{- if $ariaLabel }} aria-label="{{ $ariaLabel }}"{{ end }}
      {{- if $ariaHidden }} aria-hidden="true"{{ end }}
      {{- range $key, $value := $attributes }} {{ $key }}="{{ $value }}"{{ end -}}></i>
  </div>

{{- else -}}
  {{/* Render bare icon (no wrapper) - backward compatible */}}
  <i class="{{ $iconClass }}"
    {{- if $ariaLabel }} aria-label="{{ $ariaLabel }}"{{ end }}
    {{- if $ariaHidden }} aria-hidden="true"{{ end }}
    {{- range $key, $value := $attributes }} {{ $key }}="{{ $value }}"{{ end -}}></i>
{{- end -}}
