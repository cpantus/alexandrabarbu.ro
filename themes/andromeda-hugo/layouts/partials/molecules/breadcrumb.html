{{/*
  Breadcrumb Molecule - Navigation breadcrumb component

  Usage:
    {{ partial "molecules/breadcrumb.html" (dict
      "items" (slice
        (dict "text" "Home" "url" "/")
        (dict "text" "Services" "url" "/services/")
        (dict "text" "Current Page" "active" true)
      )
      "class" "mb-4"
    )}}

  Parameters:
    items (optional) - Array of breadcrumb items with:
      - text (required): Item text
      - url (optional): Item URL (omit for active item)
      - active (optional): Mark as active/current (default: false)
    class (optional) - Additional CSS classes for nav wrapper
    align (optional) - Alignment: left|center|right (default: left)
    autoGenerate (optional) - Auto-generate from current page (default: true if no items)
    homeText (optional) - Text for home link (default: i18n "home")

  Examples:
    Auto-generated breadcrumb:
      {{ partial "molecules/breadcrumb.html" . }}

    Custom breadcrumb:
      {{ partial "molecules/breadcrumb.html" (dict
        "items" (slice
          (dict "text" "Home" "url" "/")
          (dict "text" "Blog" "url" "/blog/")
          (dict "text" .Title "active" true)
        )
      )}}
*/}}

{{ $items := .items }}
{{ $class := .class | default "" }}
{{ $align := .align | default "left" }}
{{ $autoGenerate := .autoGenerate }}
{{ $homeText := .homeText | default (T "home") | default "Home" }}

{{/* Auto-generate breadcrumb if no items provided */}}
{{ if not $items }}
  {{ $autoGenerate = true }}
{{ end }}

{{ if $autoGenerate }}
  {{ $items = slice }}

  {{/* Add home link */}}
  {{ $items = $items | append (dict "text" $homeText "url" "/" ) }}

  {{/* Add current page as active */}}
  {{ $items = $items | append (dict "text" .Title "active" true) }}
{{ end }}

{{/* Build alignment classes */}}
{{ $alignClass := "justify-content-start" }}
{{ if eq $align "center" }}
  {{ $alignClass = "justify-content-center" }}
{{ else if eq $align "right" }}
  {{ $alignClass = "justify-content-end" }}
{{ end }}

<nav aria-label="breadcrumb" class="{{ $class }}">
  <ol class="breadcrumb {{ $alignClass }}">
    {{ range $index, $item := $items }}
      {{ $text := $item.text }}
      {{ $url := $item.url }}
      {{ $active := $item.active | default false }}

      {{/* Determine if this is the last item */}}
      {{ $isLast := eq (add $index 1) (len $items) }}
      {{ if $isLast }}
        {{ $active = true }}
      {{ end }}

      <li class="breadcrumb-item{{ if $active }} active{{ end }}"{{ if $active }} aria-current="page"{{ end }}>
        {{ if and $url (not $active) }}
          <a href="{{ $url | relLangURL }}">{{ $text }}</a>
        {{ else }}
          {{ $text }}
        {{ end }}
      </li>
    {{ end }}
  </ol>
</nav>
