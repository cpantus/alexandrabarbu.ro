{{/*
  Accordion Molecule - Collapsible accordion component (Vanilla JS)

  Usage:
    {{ partial "molecules/accordion.html" (dict
      "items" (slice
        (dict "question" "Question 1" "answer" "Answer 1")
        (dict "question" "Question 2" "answer" "Answer 2")
      )
      "id" "myAccordion"
      "defaultOpen" 0
    )}}

  Parameters:
    items (required) - Array of accordion items with:
      - question (required): Accordion item title/question
      - answer (required): Accordion item content/answer
      - markdown (optional): Apply markdownify to answer (default: true)
    id (required) - Unique ID for the accordion
    defaultOpen (optional) - Index of item to open by default (default: 0, -1 for none)
    class (optional) - Additional CSS classes for accordion wrapper
    variant (optional) - Color variant: primary|secondary|tertiary|neutral (default: primary)
    alwaysOpen (optional) - Allow multiple items to stay open (default: false)

  Examples:
    Basic FAQ accordion:
      {{ partial "molecules/accordion.html" (dict
        "items" .Params.faq_items
        "id" "faqAccordion"
        "defaultOpen" 0
      )}}

    Secondary variant:
      {{ partial "molecules/accordion.html" (dict
        "items" .items
        "id" "infoAccordion"
        "variant" "secondary"
        "alwaysOpen" true
      )}}
*/}}

{{ $items := .items }}
{{ $id := .id }}
{{ $defaultOpen := .defaultOpen }}
{{ if not (isset . "defaultOpen") }}
  {{ $defaultOpen = 0 }}
{{ end }}
{{ $class := .class | default "" }}
{{ $variant := .variant | default "primary" }}
{{ $alwaysOpen := .alwaysOpen | default false }}

{{ if not $items }}
  {{ errorf "Accordion molecule requires 'items' parameter" }}
{{ end }}

{{ if not $id }}
  {{ errorf "Accordion molecule requires 'id' parameter" }}
{{ end }}

{{/* Build accordion classes */}}
{{ $accordionClass := printf "c-accordion c-accordion--%s" $variant }}
{{ if $class }}
  {{ $accordionClass = printf "%s %s" $accordionClass $class }}
{{ end }}

<div class="{{ $accordionClass }}" id="{{ $id }}" {{ if not $alwaysOpen }}data-accordion-single="true"{{ end }}>
  {{ range $index, $item := $items }}
    {{ $question := $item.question }}
    {{ $answer := $item.answer }}
    {{ $markdown := $item.markdown }}
    {{ if not (isset $item "markdown") }}
      {{ $markdown = true }}
    {{ end }}

    {{ $isOpen := eq $index $defaultOpen }}
    {{ $itemId := printf "%sItem%d" $id $index }}
    {{ $headerId := printf "%sHeader%d" $id $index }}
    {{ $panelId := printf "%sPanel%d" $id $index }}

    <div class="c-accordion__item{{ if $isOpen }} c-accordion__item--active{{ end }}" id="{{ $itemId }}">
      <div class="c-accordion__header" id="{{ $headerId }}">
        <button
          class="c-accordion__button"
          type="button"
          data-toggle="collapse"
          data-target="#{{ $panelId }}"
          data-parent="#{{ $id }}"
          aria-expanded="{{ if $isOpen }}true{{ else }}false{{ end }}"
          aria-controls="{{ $panelId }}"
        >
          <span class="c-accordion__button-text">{{ $question }}</span>
          <span class="c-accordion__button-icon">
            {{ partial "atoms/icon.html" (dict "name" "angle-down" "size" "sm" "prefix" "las") }}
          </span>
        </button>
      </div>
      <div
        id="{{ $panelId }}"
        class="c-accordion__panel collapse{{ if $isOpen }} show{{ end }}"
        aria-labelledby="{{ $headerId }}"
        role="region"
        {{ if not $isOpen }}hidden{{ end }}
      >
        <div class="c-accordion__content">
          {{ if $markdown }}
            {{ $answer | markdownify }}
          {{ else }}
            {{ $answer | safeHTML }}
          {{ end }}
        </div>
      </div>
    </div>
  {{ end }}
</div>
