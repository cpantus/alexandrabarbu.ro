{{- /*
  Basic SEO Partial
  =================
  Includes:
  - Basic meta tags (description, author, keywords)
  - Canonical URL
  - Open Graph meta tags
  - Twitter Card meta tags
  - Schema.org structured data

  Configuration: config/_default/seo.toml
*/ -}}

{{- $title := .Title -}}
{{- if .IsHome -}}
  {{- $title = site.Title -}}
{{- end -}}

{{- $description := .Description | default .Params.description | default site.Params.description -}}
{{- $image := .Params.image | default .Params.hero_breadcrumb.image | default site.Params.metadata.image | default site.Params.logo -}}
{{- $author := site.Params.metadata.author | default site.Params.author | default site.Title -}}

{{/* Basic Meta Tags */}}
<meta name="description" content="{{ $description }}">
<meta name="author" content="{{ $author }}">

{{- with .Keywords -}}
<meta name="keywords" content="{{ delimit . ", " }}">
{{- end -}}

{{- with .Params.tags -}}
<meta name="keywords" content="{{ delimit . ", " }}">
{{- end -}}

<link rel="canonical" href="{{ .Permalink }}">

{{/* E-E-A-T Enhancement: Article date metadata */}}
{{- if .Date -}}
<meta name="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{- end -}}
{{- with .Lastmod | default .Date -}}
<meta name="article:modified_time" content="{{ (.Format "2006-01-02T15:04:05Z07:00") }}">
{{- end -}}

{{/* Open Graph Meta Tags */}}
{{- $ogConfig := site.Params.seo.opengraph | default dict -}}
{{- if $ogConfig.enabled | default true -}}
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description | truncate 200 }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ site.Title }}">
<meta property="og:locale" content="{{ .Lang | default "en" }}_{{ (upper .Lang) | default "US" }}">

{{- /* Determine OG type */ -}}
{{- $ogType := "website" -}}
{{- if .IsPage -}}
  {{- if in .RelPermalink "/article" -}}
    {{- $ogType = "article" -}}
  {{- else if in .RelPermalink "/blog" -}}
    {{- $ogType = "article" -}}
  {{- else -}}
    {{- $ogType = "website" -}}
  {{- end -}}
{{- end -}}
<meta property="og:type" content="{{ $ogType }}">

{{- with $image -}}
<meta property="og:image" content="{{ . | absURL }}">
<meta property="og:image:alt" content="{{ $title }}">
{{- end -}}

{{- /* Article-specific OG tags */ -}}
{{- if eq $ogType "article" -}}
  {{- with .Date -}}
<meta property="article:published_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}">
  {{- end -}}
  {{- with .Lastmod | default .Date -}}
<meta property="article:modified_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}">
  {{- end -}}
  {{- with .Params.author | default $author -}}
<meta property="article:author" content="{{ . }}">
  {{- end -}}
  {{- with .Params.categories -}}
<meta property="article:section" content="{{ index . 0 }}">
  {{- end -}}
  {{- range .Params.tags -}}
<meta property="article:tag" content="{{ . }}">
  {{- end -}}
{{- end -}}
{{- end -}}

{{/* Twitter Card Meta Tags */}}
{{- $twitterConfig := site.Params.seo.twitter | default dict -}}
{{- if $twitterConfig.enabled | default true -}}
{{- $cardType := $twitterConfig.card_type | default "summary_large_image" -}}
<meta name="twitter:card" content="{{ $cardType }}">
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $description | truncate 200 }}">

{{- with $image -}}
<meta name="twitter:image" content="{{ . | absURL }}">
<meta name="twitter:image:alt" content="{{ $title }}">
{{- end -}}

{{- with $twitterConfig.site -}}
<meta name="twitter:site" content="{{ . }}">
{{- end -}}

{{- with $twitterConfig.creator | default $twitterConfig.site -}}
<meta name="twitter:creator" content="{{ . }}">
{{- end -}}
{{- end -}}

{{/* llms.txt Link (for AI crawler discovery) */}}
{{- $llmsConfig := site.Params.seo.llms_txt | default dict -}}
{{- if $llmsConfig.enabled | default true -}}
<link rel="alternate" type="text/plain" title="LLMs.txt" href="{{ "llms.txt" | absURL }}">
{{- end -}}

{{/* Schema.org Structured Data */}}
{{ partial "seo/structured-data.html" . }}
