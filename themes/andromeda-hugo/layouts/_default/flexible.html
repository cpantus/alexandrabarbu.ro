{{/* Flexible Layout Template - Sequential Section Rendering */}}
{{ define "main" }}
  
  {{/* ALWAYS render page header first - regardless of section order */}}
  {{ $hasHeroBreadcrumb := false }}
  {{ range .Params.sections }}
    {{ if eq .type "hero-breadcrumb" }}
      {{ $hasHeroBreadcrumb = true }}
    {{ end }}
  {{ end }}
  
  {{/* Render page header - either from sections or default */}}
  {{ if $hasHeroBreadcrumb }}
    <!-- Page Header: hero-breadcrumb (from sections) -->
    {{ partial "sections/hero-breadcrumb.html" . }}
  {{ else }}
    <!-- Page Header: default (auto-generated) -->
    {{ partial "sections/hero-breadcrumb.html" . }}
  {{ end }}
  
  {{/* Process remaining sections in the EXACT order defined in front matter */}}
  {{ range $index, $section := .Params.sections }}
    {{ $sectionType := $section.type }}
    
    {{/* Skip hero-breadcrumb since it's already rendered above */}}
    {{ if ne $sectionType "hero-breadcrumb" }}
      {{/* Debug comment - visible in HTML source for troubleshooting */}}
      <!-- Section {{ add $index 1 }}: {{ $sectionType }} -->
      
      {{/* Sequential Section Rendering - Preserves Front Matter Order */}}
      {{ if eq $sectionType "values-intro" }}
        {{ partial "sections/values-intro.html" $ }}
      {{ else if eq $sectionType "feature-blocks" }}
        {{ partial "sections/feature-blocks.html" $ }}
      {{ else if eq $sectionType "feature-details" }}
        {{ partial "sections/feature-details.html" $ }}
      {{ else if eq $sectionType "benefits-grid" }}
        {{ partial "sections/benefits-grid.html" $ }}
      {{ else if eq $sectionType "pricing-tables" }}
        {{ partial "sections/pricing-tables.html" $ }}
      {{ else if eq $sectionType "job-listings" }}
        {{ partial "sections/job-listings.html" $ }}
      {{ else if eq $sectionType "video-popup" }}
        {{ partial "sections/video-popup.html" $ }}
      {{ else if eq $sectionType "cta-standard" }}
        {{ partial "components/call-to-action.html" $ }}
      {{ else if eq $sectionType "contact-form-enhanced" }}
        {{ partial "sections/contact-form-enhanced.html" $ }}
      {{ else if eq $sectionType "contact-info-cards" }}
        {{ partial "sections/contact-info-cards.html" $ }}
      {{ else if eq $sectionType "confidentiality-notice" }}
        {{ partial "sections/confidentiality-notice.html" $ }}
      {{ else if eq $sectionType "faq-mini" }}
        {{ partial "sections/faq-mini.html" $ }}
      {{ else if eq $sectionType "onboarding-steps" }}
        {{ partial "sections/onboarding-steps.html" $ }}
      {{ else if eq $sectionType "signup-form-enhanced" }}
        {{ partial "sections/signup-form-enhanced.html" $ }}
      {{ else if eq $sectionType "privacy-guarantee" }}
        {{ partial "sections/privacy-guarantee.html" $ }}
      {{ else }}
        <!-- Unknown section type: {{ $sectionType }} at position {{ add $index 1 }} -->
      {{ end }}
    {{ end }}
    
  {{ end }}
  
  {{/* Include pricing JavaScript if pricing section is used */}}
  {{ if in (printf "%v" .Params.sections) "pricing-tables" }}
    {{ partial "pricing-scripts.html" . }}
  {{ end }}
  
  {{/* Render page content after all sections */}}
  {{ if .Content }}
    <section class="section pt-0">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="accordion faq-accordion" id="faqAccordion">
              {{ .Content }}
            </div>
          </div>
        </div>
      </div>
    </section>
    
    {{/* Bootstrap 5 JavaScript for accordion functionality */}}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  {{ end }}
  
{{ end }}
