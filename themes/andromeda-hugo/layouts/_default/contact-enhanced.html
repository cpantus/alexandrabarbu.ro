{{ define "main" }}
  {{/* Hero Section */}}
  {{ partial "components/page-header.html" . }}

  {{/* reCAPTCHA v3 Script - Add your site key here */}}
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld0dcwrAAAAAOWMqwdKUMalBY_J-d1WTswuoRG8"></script>

  {{/* Enhanced Contact Form Section */}}
  <section class="section contact-enhanced">
    <div class="container">
      <div class="row justify-content-center align-items-center">
        <div class="col-lg-5 col-md-8 text-center mb-5 mb-lg-0" data-aos="fade-up">
          <div class="pe-0 pe-lg-5">
            <div class="floating">
              {{ partial "image.html" (dict "Src" .Params.contact_image "Alt" "contact image" "Size" "575x") }}
            </div>

            {{/* Trust badges below image */}}
            {{ with .Params.trust_badges }}
            <div class="mt-4">
              <div class="d-flex flex-wrap justify-content-center gap-2">
                {{ range . }}
                <span class="badge bg-light text-primary px-3 py-2 trust-badge">
                  <i class="las la-check-circle"></i> {{ . }}
                </span>
                {{ end }}
              </div>
            </div>
            {{ end }}
          </div>
        </div>

        {{ with site.Params.contact_form_action }}
        <div class="col-lg-5 col-md-10" data-aos="fade-up" data-aos-delay="100">
          <div class="contact-form contact-form-enhanced" id="contact-form-wrapper">
            <div class="mb-4">
              <h3 class="gradient-text">{{ T `send_a_message` | default "Trimite un mesaj" }}</h3>
              {{ with $.Params.first_consultation }}
              <div class="consultation-info-box">
                <strong>{{ .title }}:</strong> {{ .duration }}<br>
                <small>{{ .description }}</small>
              </div>
              {{ end }}
            </div>
            <form id="contact-form" action="{{ . }}" method="POST" onsubmit="return false;">
              <p id="form-status" class="form-status"></p>
              <div class="form-group mb-4">
                <label class="mb-2" for="name">{{ T `full_name` | default "Nume complet" }}</label>
                <input class="form-control shadow-none" id="name" name="name" type="text" required />
              </div>
              <div class="form-group mb-4">
                <label class="mb-2" for="email">{{ T `email` | default "Email" }}</label>
                <input class="form-control shadow-none" id="email" name="email" type="email" required />
              </div>
              <div class="form-group mb-4">
                <label class="mb-2" for="message">{{ T `your_message` | default "Mesajul tău" }}</label>
                <textarea class="form-control shadow-none" id="message" name="message" rows="4" required></textarea>
              </div>
              <button class="btn btn-primary w-100 mt-4" type="submit">
                {{ T `send_message` | default "Trimite mesaj" }}
              </button>

              {{/* Optional: reCAPTCHA Privacy Notice - Uncomment to display */}}
              {{/*
              <div class="recaptcha-privacy mt-3">
                Acest site este protejat de reCAPTCHA și se aplică
                <a href="https://policies.google.com/privacy" target="_blank">Politica de Confidențialitate</a> și
                <a href="https://policies.google.com/terms" target="_blank">Termenii de Serviciu</a> Google.
              </div>
              */}}
            </form>
          </div>
        </div>
        {{ end }}
      </div>
    </div>
  </section>

  {{/* Contact Info Cards */}}
  {{ with .Params.contact_methods }}
  <section class="section pt-0">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="row">
            {{ range . }}
            <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="100">
              <div class="contact-method-card">
                <div class="text-center">
                  <div class="contact-icon">
                    <i class="{{ .icon }}"></i>
                  </div>
                  <h4 class="mb-2">{{ .title }}</h4>
                  {{ if .link }}
                    <a href="{{ .link }}" class="text-dark mb-1 fw-bold text-decoration-none d-block hover-link">{{ .info }}</a>
                  {{ else }}
                    <p class="text-dark mb-1 fw-bold">{{ .info }}</p>
                  {{ end }}
                  <small class="text-muted">{{ .subtitle }}</small>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </section>
  {{ end }}

  {{/* FAQ Section - Hugo Way */}}
  {{ with .Params.faq_section }}
  <section class="section pt-0">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          {{ with .title }}
          <div class="text-center mb-5">
            <h3 class="gradient-text">{{ . }}</h3>
            {{ with $.Params.faq_section.subtitle }}
            <p class="text-muted">{{ . }}</p>
            {{ end }}
          </div>
          {{ end }}

          <div class="accordion faq-accordion" id="contactFaqAccordion">
            {{/* FAQ content from markdown with shortcodes */}}
            {{ $.Content }}
          </div>

          {{ with .footer_text }}
          <div class="text-center mt-4">
            <p class="text-muted">{{ . | markdownify }}</p>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
  </section>
  {{ end }}

  {{/* Confidentiality Notice */}}
  {{ with .Params.confidentiality }}
  <section class="section pt-0">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="alert alert-soft-primary d-flex align-items-center" role="alert">
            <i class="las la-lock me-3" style="font-size: 2rem;"></i>
            <div>
              <strong>{{ .title | default "Confidențialitate Garantată" }}</strong><br>
              {{ .description | default "Toate comunicările sunt protejate de secretul profesional." }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  {{ end }}

  {{/* Contact Form JavaScript */}}
  <script>
  (function() {
    const RECAPTCHA_SITE_KEY = '6Ld0dcwrAAAAAOWMqwdKUMalBY_J-d1WTswuoRG8';

    document.addEventListener('DOMContentLoaded', function() {
      const contactForm = document.getElementById('contact-form');
      const formStatus = document.getElementById('form-status');
      
      if (!contactForm || !formStatus) return;
      
      const submitButton = contactForm.querySelector('button[type="submit"]');
      if (!submitButton) return;
      
      const originalAction = contactForm.action || '{{ site.Params.contact_form_action }}';
      const originalButtonText = submitButton.textContent;
      
      contactForm.removeAttribute('action');
      
      contactForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = contactForm.querySelector('[name="name"]').value.trim();
        const email = contactForm.querySelector('[name="email"]').value.trim();
        const message = contactForm.querySelector('[name="message"]').value.trim();
        
        if (!name || !email || !message) {
          formStatus.innerHTML = '<div class="alert alert-warning"><strong>Completați toate câmpurile!</strong></div>';
          return;
        }
        
        if (submitButton.disabled) return;
        
        submitButton.disabled = true;
        submitButton.innerHTML = 'Se trimite...';
        formStatus.innerHTML = '';
        
        try {
          let recaptchaToken = '';
          if (typeof grecaptcha !== 'undefined') {
            try {
              recaptchaToken = await grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'submit'});
            } catch (e) {}
          }
          
          const formData = new FormData(contactForm);
          if (recaptchaToken) {
            formData.append('recaptcha_token', recaptchaToken);
          }
          
          await fetch(originalAction, {
            method: 'POST',
            body: formData,
            mode: 'no-cors'
          });
          
          formStatus.innerHTML = '<div class="alert alert-success"><strong>Mesaj trimis cu succes!</strong><br>Vă voi contacta în maxim 24 ore.</div>';
          contactForm.reset();
          
          setTimeout(() => {
            formStatus.innerHTML = '';
          }, 10000);
          
        } catch (error) {
          formStatus.innerHTML = '<div class="alert alert-danger"><strong>Eroare!</strong><br>Încercați din nou sau contactați direct: <a href="tel:+40722123456">+40 722.123.456</a></div>';
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = originalButtonText;
        }
      });
    });
  })();
  </script>

  <style>
  .alert {
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 8px;
    font-size: 0.95rem;
    line-height: 1.5;
  }
  .alert-success {
    background-color: #e8f5ef;
    border: 1px solid #4DB380;
    color: #2d5a3d;
  }
  .alert-warning {
    background-color: #fff3cd;
    border: 1px solid #ffc107;
    color: #856404;
  }
  .alert-danger {
    background-color: #fdf2f2;
    border: 1px solid #e57373;
    color: #721c24;
  }
  .alert a {
    color: inherit;
    text-decoration: underline;
    font-weight: 600;
  }
  </style>

{{ end }}
