{{ define "main" }}
  {{ partial "components/page-header.html" . }}

  <!-- === 1. HOW-IT-WORKS FEATURES (TOP) === -->
  {{ with .Params.how_it_works }}
    {{ if .enable }}
      <section class="section-sm">
        <div class="container">
          {{ $.Scratch.Set "counter" 0 }}
          {{ range .block }}
            {{ $.Scratch.Set "counter" (add ($.Scratch.Get "counter") 1) }}
            {{ $n := $.Scratch.Get "counter" }}
            <div class="row justify-content-center align-items-center mb-4">
              <div
                class="col-lg-5 {{ if (modBool $n 2) }}order-lg-1{{ end }}"
                data-aos="fade-up">
                <div class="section-title mb-0">
                  <p class="text-uppercase">{{ .subtitle | markdownify }}</p>
                  {{ partial "atoms/heading.html" (dict "text" .title "level" 2 "variant" "section" "class" "text-break" "markdown" true) }}
                  <p>{{ .description | markdownify }}</p>
                </div>
              </div>
              <div
                class="col-lg-6 mt-3 mt-lg-0"
                data-aos="fade-up"
                data-aos-delay="100">
                <div class="ps-0 ps-lg-3">
                  {{ partial "image.html" (dict "Src" .image "Alt" "analytics" "Size" "575x") }}
                </div>
              </div>
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}
  {{ end }}

  <!-- === 2. PRICING SECTION (MIDDLE) === -->
  {{ with .Params.pricing }}
    {{ if .enable }}
      <section class="section" data-aos="fade-in" data-aos-delay="150">
        <div class="container">
          <div class="row">
            <div class="col-md-12 text-center mb-5">
              <!-- pricing toggle -->
              {{ $toggle:= $.Params.monthly_yearly_toggle }}
              {{ if eq $toggle "toggle" }}
                {{ partial "molecules/pricing-toggle.html" (dict "class" "mb-4") }}
              {{ end }}
              {{ with $.Params.offer }}
                <span
                  class="text-primary py-2 px-3 rounded-3"
                  style="background:#f9f9f9;"
                  >{{ . | markdownify }}</span
                >
              {{ end }}
            </div>
          </div>
          <div class="row justify-content-xl-center">
            <div class="col-xl-10">
              <div class="row">
                {{ range $.Params.pricing_card }}
                  <div class="col-lg-4 col-md-6 mt-4">
                    {{ partial "molecules/card.html" (dict
                      "variant" "pricing"
                      "title" .name
                      "currency" .currency
                      "priceMonthly" .monthly_price
                      "priceYearly" .yearly_price
                      "period" (cond .monthly_price (printf "/%s" (T "month")) (cond .yearly_price (printf "/%s" (T "year")) ""))
                      "description" .content
                      "features" .services
                      "featured" .featured
                      "button" (dict
                        "text" .button_label
                        "href" (.button_link | absLangURL)
                      )
                    ) }}
                  </div>
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      </section>
    {{ end }}
  {{ end }}

  <!-- === 3. HOW-IT-WORKS VIDEO (BOTTOM) === -->
  {{ with .Params.how_it_works_video }}
    {{ if .enable }}
      <section class="section pb-0 video-popup">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-12">
              <div class="block">
                <div class="section-title text-center" data-aos="fade-up">
                  <p class="text-uppercase">{{ .subtitle | markdownify }}</p>
                  {{ partial "atoms/heading.html" (dict "text" .title "level" 2 "variant" "section" "markdown" true) }}
                  <p>{{ .description | markdownify }}</p>
                </div>

                {{ partial "molecules/video-embed.html" (dict
                  "url" .video_url
                  "thumbnail" .video_thumbnail
                  "title" (.title | default "Play Video")
                  "size" "700x"
                  "aos" "fade-up"
                  "aosDelay" 100
                ) }}
              </div>
            </div>
          </div>
        </div>
      </section>
    {{ end }}
  {{ end }}

  <!-- === PRICING JAVASCRIPT === -->
  {{ $jquery := resources.Get "plugins/jquery/jquery.min.js" | resources.Fingerprint }}
  <script crossorigin="anonymous" src="{{ $jquery.RelPermalink }}"></script>
  <script>
    // pricing toggle functionality
    if ($(".pricing-check").length !== 0) {
      // pricing init
      var toggleSwitch = $(".pricing-check");
      var dataCount = $(".data-count");
      $(toggleSwitch).change(function () {
        if ($(toggleSwitch).is(":checked")) {
          dataCount.each(function () {
            $(this).html($(this).data("count-annually"));
            $(this)
              .prop("Counter", 999)
              .animate(
                {
                  Counter: $(this).text(),
                },
                {
                  duration: 250,
                  easing: "swing",
                  step: function (now) {
                    $(this).text(Math.ceil(now));
                  },
                }
              );
          });
          $(".text-monthly").addClass("d-none").removeClass("d-inline");
          $(".text-annually").addClass("d-inline").removeClass("d-none");
        } else if ($(toggleSwitch).is(":not(:checked)")) {
          dataCount.each(function () {
            $(this).html($(this).data("count-monthly"));
            $(this)
              .prop("Counter", 999)
              .animate(
                {
                  Counter: $(this).text(),
                },
                {
                  duration: 250,
                  easing: "swing",
                  step: function (now) {
                    $(this).text(Math.ceil(now));
                  },
                }
              );
          });
          $(".text-monthly").addClass("d-inline").removeClass("d-none");
          $(".text-annually").addClass("d-none").removeClass("d-inline");
        }
      });
    }
  </script>
{{ end }}
